/*! @oneaudi/audi-core-tracking 7.2.0 - Tue, 28 Nov 2023 09:48:05 GMT
License information can be found in audi-core-tracking-events.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("core-tracking-objects")):"function"==typeof define&&define.amd?define("core-tracking-events",["core-tracking-objects"],e):"object"==typeof exports?exports["core-tracking-events"]=e(require("core-tracking-objects")):t["core-tracking-events"]=e(t["core-tracking-objects"])}(self,(t=>(()=>{"use strict";var e={525:e=>{e.exports=t}},a={};function i(t){var n=a[t];if(void 0!==n)return n.exports;var s=a[t]={exports:{}};return e[t](s,s.exports,i),s.exports}i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};return(()=>{i.r(n);class t{static get REGISTERED_DIGITALDATA_OBJECTS(){return["page","component","dealer","product","cart","user","search"]}constructor(){if(t._instance)return t._instance;window.digitalData=window.digitalData||{},window.digitalData.event=window.digitalData.event||[],this.eventObjectsQueue=[],this.registeredPropertyObjectsQueue={},t._instance=this}storeObjectsInDigitalData(t){window.digitalData.hasOwnProperty("page")?this._writeDataToWindowObject(t):t.hasOwnProperty("page")?this._writeDataToWindowObject(this._mergeRegisteredPropertyObjects(t)):Object.keys(t).forEach((e=>{this.registeredPropertyObjectsQueue[e]=t[e]}))}storeEventsInDigitalData(t){Object.keys(t).length>0&&(0===window.digitalData.event.length&&"page_load"!==this._getEventAction(t)?this.eventObjectsQueue.push(t):(window.digitalData.event.push(t),this._processEventObjectsQueue()))}_writeDataToWindowObject(e){t.REGISTERED_DIGITALDATA_OBJECTS.forEach((t=>{void 0!==e[t]&&(window.digitalData[t]=e[t])}))}_mergeRegisteredPropertyObjects(e){return e&&this.registeredPropertyObjectsQueue!=={}&&t.REGISTERED_DIGITALDATA_OBJECTS.forEach((t=>{void 0!==this.registeredPropertyObjectsQueue[t]&&(e[t]=this.registeredPropertyObjectsQueue[t])})),this.registeredPropertyObjectsQueue={},e}_processEventObjectsQueue(){const t=this.eventObjectsQueue.length;if(t>0){for(let e=0;e<t;e+=1)window.digitalData.event.push(this.eventObjectsQueue[e]);this.eventObjectsQueue=[]}}_getEventAction(t){let e="";return t&&t.eventInfo&&t.eventInfo.eventAction&&(e=t.eventInfo.eventAction),e}}const e=new t;var a=i(525);class s{constructor(){if(s._instance)return s._instance;this.initialize(),s._instance=this}initialize(){this._saveTrackingData=this._saveTrackingData.bind(this),this._saveTrackingData(),this._addEvents()}_addEvents(){document.addEventListener("configuration-update-tracking",this._saveTrackingData)}async _saveTrackingData(){const t=await this._getObjectData();Object.keys(t).length>0&&e.storeObjectsInDigitalData(t)}async _getObjectData(){const t=await a.cartService.getData(),e={};return 0===Object.keys(t).length&&t.constructor===Object||(e.cart=t),e}}new s;class r{constructor(){if(r._instance)return r._instance;this.initialize(),r._instance=this}initialize(){this._handleClickEvent=this._handleClickEvent.bind(this),this._saveTrackingData=this._saveTrackingData.bind(this),this.currentLocation=window.location.href,document.body.addEventListener("click",this._handleClickEvent)}_handleClickEvent(t){t&&t.target&&!this._isElementExcludedFromTracking(t.target)&&this._saveTrackingData(t.target)}async _saveTrackingData(t){let i=await a.clickEventService.getData(t,this.currentLocation);0!==Object.keys(i).length&&(e.storeEventsInDigitalData(i),this.currentLocation=window.location.href)}_isElementExcludedFromTracking(t){const e=t.dataset.trackingExclude,a=t.closest("[data-audi-core-tracking-exclude]"),i=t.closest("feature-app");let n=!1,s=!1;if(i){const e=i.querySelector('[data-audi-core-tracking-include="true"]');n=i.getAttribute("data-audi-core-tracking-include"),s=e&&e.contains(t)}const r=n||s;return!!(e||i&&!r||i&&r&&a&&i.contains(a)||!i&&a)}}new r;class c{constructor(){if(c._instance)return c._instance;this.initialize(),c._instance=this}initialize(){this._saveTrackingData=this._saveTrackingData.bind(this),this._addEvents()}_addEvents(){document.addEventListener("configuration-tracking",this._saveTrackingData)}async _saveTrackingData(t){if(t&&t.detail&&Object.keys(t.detail).length>0){const a=await this._getCartData();Object.keys(a).length>0&&e.storeObjectsInDigitalData(a),e.storeEventsInDigitalData(t.detail)}}async _getCartData(){const t=await a.cartService.getData(),e={};return!t||0===Object.keys(t).length&&t.constructor===Object||(e.cart=t),e}}new c;class o{constructor(){if(o._instance)return o._instance;o._instance=this,this._saveTrackingData=this._saveTrackingData.bind(this),this._addEventListeners()}_addEventListeners(){document.addEventListener(a.CustomEventService.CUSTOM_TRACKING_EVENT,this._saveTrackingData)}_saveTrackingData(t){const a=t.detail;a&&0!==Object.keys(a).length&&e.storeEventsInDigitalData(a)}}new o;class g{constructor(){if(g._instance)return g._instance;this.initialize(),g._instance=this}initialize(){this._addEvents()}_addEvents(){document.addEventListener("DEALER_LOADED",this._saveTrackingData)}async _saveTrackingData(){const t=await a.dealerService.getData();if(t.length>0){const a={dealer:t};e.storeObjectsInDigitalData(a)}}}new g;class d{constructor(){if(d._instance)return d._instance;this.initialize(),d._instance=this}initialize(){this._saveTrackingData=this._saveTrackingData.bind(this),this._saveTrackingData(),this._addEvents()}_addEvents(){document.addEventListener("PAGE_READY",this._saveTrackingData),document.addEventListener("LAYER_LOADED",this._saveTrackingData),document.addEventListener("LAYER_CLOSED",this._saveTrackingData)}async _saveTrackingData(t){const a=void 0!==t?t.type:"",i=await this._getObjectData();e.storeObjectsInDigitalData(i);const n=await this._getEventData(a);e.storeEventsInDigitalData(n)}async _getObjectData(){const t=await this._getProductData(),e=await this._getCartData(),a=await this._getSearchData(),i=await this._getDealerData(),n={component:await this._getComponentData(),page:await this._getPageData(),user:[await this._getUserData()]};return 0===Object.keys(t).length&&t.constructor===Array||(n.product=t),0===Object.keys(e).length&&e.constructor===Object||(n.cart=e),0===Object.keys(a).length&&a.constructor===Object||(n.search=a),i.length>0&&(n.dealer=i),n}async _getEventData(t){return await a.stateEventService.getData(t)}async _getPageData(){return await a.pageService.getData()}async _getComponentData(){return await a.componentService.getData()}async _getProductData(){return await a.productService.getData()}async _getCartData(){return await a.cartService.getData()}async _getUserData(){return await a.userService.getData()}async _getSearchData(){return await a.searchService.getData()}async _getDealerData(){return await a.dealerService.getData()}}new d;class h{constructor(){if(h._instance)return h._instance;this.initialize(),h._instance=this}initialize(){this._saveTrackingData=this._saveTrackingData.bind(this),document.addEventListener("SEARCH_UPDATED",this._saveTrackingData)}async _saveTrackingData(){let t={};const i=await a.searchService.getData();Object.keys(i).length>0&&(t.search=i,e.storeObjectsInDigitalData(t))}}new h})(),n})()));
//# sourceMappingURL=audi-core-tracking-events.js.map