/*! @oneaudi/audi-core-application 8.0.2 - Mon, 14 Aug 2023 12:27:00 GMT
License information can be found in audi-core-application.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("core-utils"),require("microkernel"),require("core-vendor")):"function"==typeof define&&define.amd?define("core-application",["core-utils","microkernel","core-vendor"],t):"object"==typeof exports?exports["core-application"]=t(require("core-utils"),require("microkernel"),require("core-vendor")):e["core-application"]=t(e["core-utils"],e.microkernel,e["core-vendor"])}(self,((e,t,n)=>(()=>{"use strict";var o={39:t=>{t.exports=e},954:e=>{e.exports=n},214:e=>{e.exports=t}},a={};function r(e){var t=a[e];if(void 0!==t)return t.exports;var n=a[e]={exports:{}};return o[e](n,n.exports,r),n.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};return(()=>{r.r(s),r.d(s,{FootnotesEngine:()=>h,ModalLayer:()=>E,ModalLayerContentBase:()=>y,ModalLayerWrapper:()=>S,appEvents:()=>t,cache:()=>T,clientLayer:()=>x,content:()=>j,dynamicDot:()=>V,dynamicSmoothScroll:()=>i,layerAnimation:()=>v,layerApi:()=>P,layerCms:()=>G,layerDom:()=>W,layerElement:()=>R,layerErrorTemplate:()=>Y,layerTitle:()=>X,modalLayer:()=>g,modalLayerFootnoteEngineTemplate:()=>J,pageDom:()=>K,pageMain:()=>$,pagePreload:()=>te,pageTitle:()=>oe,pageType:()=>re,router:()=>k,routerState:()=>D,scroll:()=>ie,signal:()=>_,staticContent:()=>B,suppressSpaceAfterToolbar:()=>_e});var e=r(39);const t={VERSION_LOAD_COMPLETE:"version.load.complete",CARINFO_LOAD_COMPLETE:"carinfo.load.complete",MODELSINFO_LOAD_COMPLETE:"modelsinfo.load.complete",APP_READY:"app.ready",APP_INITIALIZED:"app.initialized",AVE_AVAILABLE:"ave.available",AVE_STREAM_READY:"ave.stream.ready",CONFIG_RESET:"configuration.reset",CONFIG_UPDATE:"configuration.update",CONFIG_START:"configuration.start",CONFIG_PARSED:"configuration.parsed",CONFIG_ITEM_CLICKED:"configuration.item-clicked",DOM_UPDATED:"dom.updated",TRIGGER_DOM_UPDATE:"trigger.dom.update",CONFIG_ADOPT:"configuration.adopt-new",CONFIG_PDF:"configuration.pdf",CONFIG_SEND:"configuration.send",CONFIG_SAVED:"configuration.saved",CONFIG_CONFLICT_OPEN:"configuration.conflict-open",CONFIG_NON_CONFLICTING:"configuration.non-conflicting",CONFIG_CHANGEREQUEST_START:"configuration.change-request-start",CONFIG_CHANGEREQUEST_END:"configuration.change-request-end",CONFIG_CONFLICT_CHECK:"configuration.conflict-check",CONFLICT_CLOSE:"conflict.resolve",TRANSFER_CLOSE:"transfer.cancel",FORM_FINISHED:"form.finished",FORM_LOADED:"form.loaded",HASH_CHANGE:"hash.change",FORM_ERROR:"form.error",INTERSTITIAL_LAYER_CLOSE:"interstitial-layer.close",LAYER_OPEN:"layer.open",LAYER_CLOSE:"layer.close",LAYER_INSERTED:"layer.inserted",LAYER_LOADED:"layer.loaded",LAYER_STATIC_OPEN:"layer.static.open",LAYER_BEFORE_CLOSE_ALL:"layer.before.closeall",LAYER_BEFORE_CLOSE:"layer.before.close",LAYER_CLOSED:"layer.closed",EQUIPMENT_SEARCH_LAYER_LOADED:"equipmentSearchlayer.loaded",EQUIPMENT_SEARCH_LAYER_RESIZED:"equipmentSearchlayer.resized",RENDERINGLAYER_LOADED:"renderinglayer.loaded",RENDERINGLAYER_RESIZED:"renderinglayer.resized",STARTLAYER_OPEN:"startlayer.open",STARTLAYER_CLOSE:"startlayer.close",TRANSFERLAYER_CLOSED:"transferlayer.closed",SEARCH_OPEN:"search.nemo.open",SEARCH_CLOSE:"search.nemo.close",SEARCH_LOAD_AUDICODE:"search.load.audicode",SEARCH_LOADED:"search.loaded",MENUFLYOUT_OPEN:"menuflyout.open",MENUFLYOUT_CLOSE:"menuflyout.close",PAGE_NAV:"page.nav",PAGE_OPEN:"page.open",PAGE_LEAVE:"page.leave",PAGE_READY:"page.ready",PAGE_INSERTED:"page.inserted",PAGE_LOADED:"page.loaded",PAGE_ANIMATION_START:"page.animation.start",PAGE_ANIMATION_COMPLETE:"page.animation.complete",MEDIAGALLERY_CATEGORY_CHANGED:"mediagallery.category.changed",MEDIAGALLERY_ITEM_CHANGED:"mediagallery.item.changed",MEDIAGALLERY_RESIZED:"mediagallery.resized",MEDIAGALLERY_SLIDED:"mediagallery.slided",UPDATE_VIEW_STATE:"stage.updateViewState",STAGE_RENDERIMAGE_UPDATED:"stage.renderimage.updated",EXTERNAL_EDITOR:"configuration.external.nemo.configurator",ERROR:"nemo.error",NOTIFICATION:"nemo.notification",MYAUDI_LOGIN:"myaudi.login",MYAUDI_LOGOUT:"myaudi.logout",CONTENT_RESIZE:"content.resize",AUDICODE_DELETED:"audicode.deleted",AUDICODE_SUCCESS:"audicode.success",AUDICODE_FAILED:"audicode.failed",TEASER_ACTIVATED:"teaserActivated",TEASER_ALL_ACTIVATED:"allTeasersActivated",RESET_POSTERVIEW:"mss.reset.posterview",STOCKCAR_UPDATE:"stck.update",SC_UPDATE_VIEW:"sc:update:view",SC_UPDATE_VIEW_COUNTS:"sc:update:view:counts",SC_RESET_RESULT_COUNT:"sc:reset:result:counts",SC_UPDATE_VIEW_RANGE_FILTER:"sc:update:view:range:filter",SC_UPDATE_VIEW_FAVORITES:"sc:update:view:favorites",SC_DELETE_VIEW_FAVORITE:"sc:delete:view:favorite",SC_DELETE_OUTDATET_FAVORITE:"sc:delete:outdatet:favorite",SC_RESET_VIEW:"sc:reset:view",SC_UPDATE_LOCATION_VIEW:"sc:update:location:view",SC_ERROR_GPS:"sc:error:gps",SC_UPDATE_VEHICLES:"sc:increment:vehicles",SC_UPDATE_LOCATION_MODEL:"sc:update:location:model",SC_UPDATE_LOCATION_FILTER:"sc:update:location:filter",SC_UPDATE_FAVORITE_COUNT:"sc:update:favorite:count",SC_COMPARE_UPDATE:"sc:compare:update",SC_VERSION_LOADED:"sc:version:loaded",SC_DETAILS_RATE_UPDATE:"sc:details:updateRate",SC_ERROR:"sc:error",CONTENT_RENDERED:"content:rendered",DSH_ZOOM_CHANGE:"dsh:zoom.change",DSH_INPUT:"dsh:input"};class n{static get FOOTNOTES_LIST_SELECTOR(){return".audi-footnotes-list"}static get FOOTNOTES_LAYER_PREFIX(){return"layer_footnote_"}static get FOOTNOTES_REFERENCE_SELECTOR(){return".audi-j-footnote-reference"}static get FOOTNOTES_ANCHOR_TEXT_SELECTOR(){return".audi-footnote-anchor__text"}static get FOOTNOTES_REFERENCE_DISABLED_SELECTOR(){return"audi-footnote-reference-disabled"}static get MODAL_INNER_SELECTOR(){return".modal-layer__inner"}static get MODAL_INNER_CONTENT_SELECTOR(){return".modal-layer__inner-content"}static get MODAL_LAYER_CONTENT_SELECTOR(){return".modal-layer__content"}static get LAYER_CONTENT_SELECTOR(){return".nm-layer-inner"}static createFootnoteContainer(){const e=document.createElement("div");return e.classList.add("audi-footnotes"),e.classList.add("audi-footnotes-wrapper"),e.setAttribute("data-module","footnotes"),e.innerHTML='<ul class="'+n.FOOTNOTES_LIST_SELECTOR.substr(1)+'"></ul>',e}static replaceTextWithFootnoteNumber(e,t){if(!e.dataset.fixedText){e.querySelector(n.FOOTNOTES_ANCHOR_TEXT_SELECTOR).innerHTML=t}}static extractFootnoteId(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const t=e.indexOf("#");return-1!==t&&(e=e.substr(t+1)),e}static removePrefixFromId(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace(/^layer_footnote_/gi,"")}static setReferenceState(e,t){t?e.classList.remove(n.FOOTNOTES_REFERENCE_DISABLED_SELECTOR):e.classList.add(n.FOOTNOTES_REFERENCE_DISABLED_SELECTOR)}}class o{static renderFootnotes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=arguments.length>1?arguments[1]:void 0;if(!t)return;t.innerHTML="";const n=document.createDocumentFragment();e.forEach((e=>{n.appendChild(e)})),t.appendChild(n),o._dispatchRenderedEvent(t)}static _dispatchRenderedEvent(e){document.dispatchEvent(new CustomEvent("FOOTNOTES_RENDERED",{detail:{context:e}}))}}const a=o;class i{static get MODAL_INNER_SELECTOR(){return".modal-layer__inner"}static get MODAL_LAYER_SELECTOR(){return".modal-layer"}static get LAYER_WRAPPER_SELECTOR(){return".nm-layer-wrapper"}static get LAYER_CONTENT_SELECTOR(){return".nm-layer-inner"}static get AVERAGE_PAGE_SIZE(){return 4e3}static get AVERAGE_SIZE_SCROLL_DURATION(){return 660}static scroll(e,t,n){let o=null,a=0,r=e.getBoundingClientRect().top,s=r>=n;const i=this.calculateAnimationDuration(n,r),l=c=>{o||(o=c||(new Date).getTime());let d=(c-o)/i,u=this.getRequiredOffset();if(d>1)return cancelAnimationFrame(o),void t.scrollTo(0,r-u);let h=Math.abs(this.easeOutQuad(d)).toFixed(2),m=this.calculateScrollDestination(e);m!==r&&(r=m),a=s?n+r*h:r+(n-r)*(1-h),t.scrollTo(0,a),s&&(0!==r&&a>=r-u||0===r&&a<0||m-n<=300)||!s&&a<r+u?(cancelAnimationFrame(o),a=0,t.scrollTo(0,r-u)):window.requestAnimationFrame(l)};window.requestAnimationFrame(l)}static getRequiredOffset(){let e=120+this.getStickyNavigationOffset()+this.getStickyAnchorNavigationOffset();return 120!==e&&(e+=30),e}static getStickyNavigationOffset(){let e=0;if(this.getScrollContext()===document.body&&document.body.classList.contains("nm-nav-fixed")){const t=document.querySelector(".nm-nav-wrap");if(t&&(e=t.clientHeight),document.body.classList.contains("nm-has-current-consumption")){const t=document.querySelector(".nm-module-current-consumption");t&&(e+=t.clientHeight)}}return e}static getStickyAnchorNavigationOffset(){const e=document.querySelector(".nm-anchor-navigation-list");let t=0;if(this.getScrollContext()===document.body&&e){"true"===e.getAttribute("is-sticky")&&(t=e.clientHeight)}return t}static easeOutQuad(e){return e*(2-e)}static calculateAnimationDuration(e,t){const n=Math.abs(t-e);return i.AVERAGE_SIZE_SCROLL_DURATION/i.AVERAGE_PAGE_SIZE*n}static calculateScrollDestination(e){const t=this.getScrollContext(),n=t.getBoundingClientRect(),o=e.getBoundingClientRect(),a=t===document.body?0:t.scrollTop;return o.top-n.top+a}static getScrollContext(){return document.querySelector(this.MODAL_INNER_SELECTOR)?document.querySelector(this.MODAL_LAYER_SELECTOR):document.querySelector(this.LAYER_CONTENT_SELECTOR)?document.querySelector(this.LAYER_WRAPPER_SELECTOR):document.body}}class l{constructor(){this._addEvents()}_addEvents(){this._handleFootnoteReferenceClick=this._handleFootnoteReferenceClick.bind(this),e.dom.getEventDelegate("body").on("click",n.FOOTNOTES_REFERENCE_SELECTOR,this._handleFootnoteReferenceClick)}_handleFootnoteReferenceClick(e){e.preventDefault();const t=e.target.closest(n.FOOTNOTES_REFERENCE_SELECTOR),o=this._getFootnoteByReference(t);if(o){const t=i.getScrollContext(),n=t===document.body?window:t,a=t===document.body?e.pageY:e.pageY+t.scrollTop;i.scroll(o,n,a)}}_getFootnoteByReference(e){if(e&&e.getAttribute("href"))return i.getScrollContext().querySelector(e.getAttribute("href"))}}var c=r(214);const d=function(){return{...arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},...arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}}};class u{static get ACTIONS(){return{UPDATE_FOOTNOTES:"updateFootnotes"}}static addFootnotesStore(){c.stateRegistry.addStore("dbadFootnotesStore",{},{updateFootnotes:d})}}class h{static get defaults(){return{FOOTNOTES_WRAPPER_SELECTOR:".audi-footnotes-wrapper"}}constructor(){this.footnotesSmoothscroll=new l,this._bindEventHandler(),this._addEvents(),u.addFootnotesStore(),c.stateRegistry.subscribeToStore("dbadFootnotesStore",this._handleStoreUpdate)}_bindEventHandler(){this._handleStoreUpdate=this._handleStoreUpdate.bind(this),this._handleContentUpdate=this._handleContentUpdate.bind(this),this._handleFootnotesUpdate=e.dom.debounce(this._handleFootnotesUpdate,250)}_addEvents(){document.addEventListener("PAGE_READY",this._handleContentUpdate),document.addEventListener("LAYER_LOADED",this._handleContentUpdate),document.addEventListener(t.CONTENT_RENDERED,this._handleContentUpdate)}_handleStoreUpdate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.footnotesInStore=e,Object.keys(this.footnotesInStore).length&&this._handleFootnotesUpdate()}async _handleContentUpdate(n){let o=this._handleContentUpdateDefaultCondition;"LAYER_LOADED"!==n.type&&n.type!==t.CONTENT_RENDERED||(document.querySelector(".modal-layer--open")?o=this._handleContentUpdateModalLayerCondition:document.querySelector(".nm-layer-opened")&&(o=this._handleContentUpdateDefaultLayerCondition));try{await e.polling.wait(o,1e3),this._handleFootnotesUpdate()}catch(e){console.warn("could not handle footnote content",e)}}_handleContentUpdateDefaultCondition(){return!0}_handleContentUpdateModalLayerCondition(){return!!document.querySelector(n.MODAL_INNER_SELECTOR)}_handleContentUpdateDefaultLayerCondition(){return!!document.querySelector(n.LAYER_CONTENT_SELECTOR)}_handleFootnotesUpdate(){const e=i.getScrollContext(),t=this._isContextOfTypeLayer(e),n=[...this._findFootnoteReferences(e)];if(n.length>0){const o=this._prepareFootnotesForRendering(n,e,t);this._processFootnoteReferences(n,o,t)}else this._removeFootnoteWrapper(e)}_findFootnoteReferences(e){return e.querySelectorAll(n.FOOTNOTES_REFERENCE_SELECTOR)}_prepareFootnotesForRendering(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=this._collectFootnoteIdsFromReferences(e),r=this._getFootnoteWrapper(t);if(o.length>0){const e=this._getFootnotesByIdFromStore(o,n);a.renderFootnotes(e,r)}return o}_processFootnoteReferences(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((o=>{t&&this._addPrefixToReferenceForLayer(o);const a=n.extractFootnoteId(o.getAttribute("href"));let r=e.indexOf(n.removePrefixFromId(a));-1===r&&(r=e.indexOf(n.FOOTNOTES_LAYER_PREFIX+a));const s=-1!==r;n.setReferenceState(o,s),n.replaceTextWithFootnoteNumber(o,r+1)}))}_collectFootnoteIdsFromReferences(){let e=[];return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((t=>{const o=n.removePrefixFromId(n.extractFootnoteId(t.getAttribute("href")));-1===e.indexOf(o)&&this._isValidFootnoteReference(o)&&e.push(o)})),e}_isValidFootnoteReference(e){const t=n.removePrefixFromId(e);return!!this.footnotesInStore[t]}_getFootnoteWrapper(e){let t=e;if(!this._hasContextFootnoteWrapper(e)){const e=n.createFootnoteContainer();t.querySelector(n.MODAL_INNER_SELECTOR)?t=t.querySelector(n.MODAL_LAYER_CONTENT_SELECTOR):t.querySelector(n.LAYER_CONTENT_SELECTOR)?t=t.querySelector(n.LAYER_CONTENT_SELECTOR):t.querySelector(".nm-footer")&&(t=t.querySelector(".nm-footer")),t.appendChild(e)}return t.querySelector(h.defaults.FOOTNOTES_WRAPPER_SELECTOR+" "+n.FOOTNOTES_LIST_SELECTOR)}_hasContextFootnoteWrapper(e){return!!e.querySelector(h.defaults.FOOTNOTES_WRAPPER_SELECTOR)}_removeFootnoteWrapper(e){if(this._hasContextFootnoteWrapper(e)){const t=e.querySelector(h.defaults.FOOTNOTES_WRAPPER_SELECTOR);t.parentElement.removeChild(t)}}_isContextOfTypeLayer(e){const t=e;return!(!t.querySelector(n.MODAL_INNER_SELECTOR)&&!t.querySelector(n.LAYER_CONTENT_SELECTOR))}_getFootnotesByIdFromStore(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=new Map,a=1;return e.forEach((e=>{const r=n.removePrefixFromId(e);if(this.footnotesInStore[r]){const e=this.footnotesInStore[r],s=document.createElement("div");s.innerHTML=e,s.querySelector(n.FOOTNOTES_ANCHOR_TEXT_SELECTOR).innerHTML=a,t?(s.firstChild.setAttribute("id",n.FOOTNOTES_LAYER_PREFIX+r),o.set(n.FOOTNOTES_LAYER_PREFIX+r,s.firstChild)):o.set(r,s.firstChild),a++}})),[...o.values()]}_addPrefixToReferenceForLayer(e){const t=e.getAttribute("href"),o=n.extractFootnoteId(t),a=n.removePrefixFromId(o),r=n.FOOTNOTES_LAYER_PREFIX+a;e.setAttribute("href","#"+r)}}class m extends HTMLElement{constructor(){super(),window.footnotesEngine||(window.footnotesEngine=new h),this.footnoteItems=null}connectedCallback(){const e=this.querySelector(".audi-footnotes-list");e&&e.children.length>0&&(this.footnoteItems=this._parseFootnotesMarkup(e.children)),this.parentElement.removeChild(this)}disconnectedCallback(){this.footnoteItems&&c.stateRegistry.triggerAction("dbadFootnotesStore",u.ACTIONS.UPDATE_FOOTNOTES,this.footnoteItems)}_parseFootnotesMarkup(){let e={};return[...arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]].forEach((t=>{const n=t.getAttribute("id"),o=t.outerHTML;e[n]=o})),e}}void 0===window.customElements.get("audi-footnotes")&&window.customElements.define("audi-footnotes",m);class p extends HTMLElement{constructor(){super(),this._addPageStore()}connectedCallback(){this._handlePageUpdate=this._handlePageUpdate.bind(this),this._handleLayerUpdate=this._handleLayerUpdate.bind(this),document.addEventListener("PAGE_READY",this._handlePageUpdate),document.addEventListener("LAYER_LOADED",this._handleLayerUpdate),document.addEventListener("LAYER_CLOSED",this._handleLayerUpdate),this._handlePageUpdate()}_addPageStore(){const e=this;c.stateRegistry.addStore("dbadPageStore",{baseURL:window.location.origin,currentURL:window.location.href,isLayer:this._isLayer(),language:this._getLanguage(window.location.href,window.location.pathname),market:this._getMarket(window.location.href,window.location.pathname),pageName:document.title,pageTemplate:this._getPageTemplate(),pageType:this._getPageType(),referringURL:document.referrer||"",scopes:this._getScopes()},{updateLayerState:function(t){return{...t,currentURL:window.location.href,isLayer:e._isLayer(),pageName:document.title}},updatePageState:function(t,n){return{...t,currentURL:window.location.href,isLayer:e._isLayer(),pageName:document.title,pageTemplate:n.pageTemplate,pageType:n.pageType}}})}_getScopes(){const e=document.querySelector(".nm-activated-scopes");return e?e.dataset.scopes:""}_handlePageUpdate(){c.stateRegistry.triggerAction("dbadPageStore","updatePageState",{currentURL:window.location.href,isLayer:this._isLayer(),pageName:document.title,pageTemplate:this._getPageTemplate(),pageType:this._getPageType()})}_handleLayerUpdate(){c.stateRegistry.triggerAction("dbadPageStore","updateLayerState",{currentURL:window.location.href,isLayer:this._isLayer(),pageName:document.title})}_getPageTemplate(){return SETUPS&&SETUPS.get("page.template")||""}_getPageType(){return document.body.getAttribute("page-type")||"default"}_isLayer(){return!!this._hasSubString(window.location.href,"jslayer=")||(!!this._hasSubString(window.location.href,"layer=")||(!!document.body.classList.contains("modal-layer--open")||!!document.querySelector(".nm-layer-conflict.nm-layer-visible")))}_getMarket(e,t){let n="";return this._hasLocalMarket()?n=this._getLocalMarket():this._getMarketFromPageID(e,t)&&(n=this._getMarketFromPageID(e,t)),n.toUpperCase()}_hasLocalMarket(){return this._hasSetupsValue("LocaleCountry")||this._hasSetupsValue("nemo.locale.country")}_getLocalMarket(){let e="";return this._hasSetupsValue("LocaleCountry")?e=this._getSetupsValue("LocaleCountry"):this._hasSetupsValue("nemo.locale.country")&&(e=this._getSetupsValue("nemo.locale.country")),e}_getMarketFromPageID(e,t){let n="",o=this._getPageID(e,t).split("/");return o&&o[1]&&(n=o[1]),n}_getLanguage(e,t){let n="";return n=this._hasLocalLanguage()?this._getLocalLanguage():this._getLanguageFromPageID(e,t),n.toLowerCase()}_hasLocalLanguage(){return this._hasSetupsValue("LocaleLanguage")||this._hasSetupsValue("nemo.locale.language")}_getLocalLanguage(){let e="";return this._hasSetupsValue("LocaleLanguage")?e=this._getSetupsValue("LocaleLanguage"):this._hasSetupsValue("nemo.locale.language")&&(e=this._getSetupsValue("nemo.locale.language")),e}_getLanguageFromPageID(e,t){let n="",o=this._getPageID(e,t).split("/");return o&&o[3]&&(n=o[3]),n.toLowerCase()}_getPageID(e,t){let n=t;return this._hasSubString(e,"jslayer=")?n=this._getPageIdForJsLayer(n,e):this._hasSubString(e,"layer=")?n=this._getSubStringByMarker(e,"layer="):this._hasSubString(e,"page=")&&(n=this._getSubStringByMarker(e,"page=")),n=this._removeTrailingHtmlExtension(n),n}_getPageIdForJsLayer(e,t){let n=this._getSubStringByMarker(t,"jslayer="),o=e;return this._hasSubString(t,"page=")&&(o=this._getSubStringByMarker(t,"page=")),o=this._removeTrailingHtmlExtension(o),o+"/"+n}_hasSetupsValue(e){let t=!1;return SETUPS&&SETUPS.get(e)&&""!==SETUPS.get(e)&&(t=!0),t}_getSetupsValue(e){let t="";return SETUPS&&SETUPS.get(e)&&""!==SETUPS.get(e)&&(t=SETUPS.get(e)),t}_hasSubString(e,t){return-1!==e.indexOf(t)}_getSubStringByMarker(e,t){return this._hasSubString(e,t)?e.substr(e.indexOf(t)+t.length):""}_removeTrailingHtmlExtension(e){let t=e;return t.indexOf(".html")>0&&(t=t.substr(0,t.indexOf(".html"))),t}}void 0===window.customElements.get("audi-page-store")&&window.customElements.define("audi-page-store",p);class E{constructor(){this._registerdLayers=new Map,this._registeredLayers=new Map}static get MODAL_LAYER_OPEN_EVENT(){return"modalLayer:open"}static get MODAL_LAYER_CLOSE_EVENT(){return"modalLayer:close"}async getLayerContent(e){const t=this._registerdLayers.get(e.layerType),n=this._registeredLayers.get(e.layerType);let o;if(t)o=await t.getContent(e);else{if(!n)throw new Error("modal layer content not found.");o=await n.getContent(e)}return o}registerLayerType(e){this._registerdLayers.set(e.type,e)}registerModalLayer(e,t){this._registeredLayers.set(e,t)}unregisterLayerType(e){this._registerdLayers.delete(e)}unregisterModalLayer(e){this._registeredLayers.delete(e)}}if(!document.querySelector(".modal-layer")){let e=document.createElement("modal-layer-wrapper");document.body.appendChild(e)}const g=new E;class y extends HTMLElement{constructor(){super()}static async getContent(){throw new Error("get content method has to be overridden from layer content element!")}static get type(){return"ModalLayerContentBase"}async beforeOpen(){return!0}async beforeClose(){return!0}async _triggerOpen(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{const t=this.closest("modal-layer-wrapper");await t.open(this,e)}catch(e){throw console.warn("_triggerOpen - modal layer wrapper missing."),e}}async _triggerClose(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{const t=this.closest("modal-layer-wrapper");await t.close(this,e)}catch(e){throw console.warn("_triggerClose - modal layer wrapper missing."),e}}}void 0===window.customElements.get("modal-layer-content-base")&&window.customElements.define("modal-layer-content-base",y);var f=r(954);const L={},_={__:L};L.defaultConfig={maxListeners:0,newListener:!1,wildcard:!0},f.eventEmitter.prototype.one=f.eventEmitter.prototype.once,f.eventEmitter.prototype.trigger=f.eventEmitter.prototype.emit,L.defaultEmitter=new f.eventEmitter(L.defaultConfig),L.defaultEmitter.trigger=function(){L.defaultEmitter.emit.apply(this,arguments)},L.emitters={default:L.defaultEmitter},_.getEmitter=function(e){return void 0===e?L.emitters.default:(L.emitters[e]=L.emitters[e]||new f.eventEmitter(L.defaultConfig),L.emitters[e])};class S extends HTMLElement{constructor(){super(),this.layerStack=[],this._bindContextToFunctions()}static get defaults(){return{attributeState:"data-layer-active",centerVertically:"modal-layer--centered",close:"modal-layer--close",contentWrapper:".modal-layer__content",contentWrapperClassName:"modal-layer__content",contentWrapperHide:"modal-layer__content--hide",contentWrapperShow:"modal-layer__content--show",hidden:"sc-hidden",modalLayer:".modal-layer",modalLayerLink:".js-modal-layer-link",modalLayerNoTransition:"modal-layer--no-transition",modalLayerOptions:".modal-layer__inner [data-layer-options]",open:"modal-layer--open",shader:".modal-layer__shader-click-area"}}static get defaultOptions(){return{addCssClass:"",centerVertically:!1,onEscClick:!0,onShaderClick:!0}}connectedCallback(){this.eventDelegate=e.dom.getEventDelegate("body"),this.globalEventEmitter=_.getEmitter(),this._setElementDomProperties(),this._addEvents()}disconnectedCallback(){this._removeEvents()}_setElementDomProperties(){this.classList.add("modal-layer"),this.setAttribute("data-layer-active","false"),this.setAttribute("data-module","modal-layer"),this.contentWrapper=document.createElement("div"),this.contentWrapper.classList.add("modal-layer__content"),this.shader=document.createElement("div"),this.shader.classList.add("modal-layer__shader-click-area"),this.appendChild(this.shader),this.appendChild(this.contentWrapper),this.modalLayer=document.querySelector(S.defaults.modalLayer),this.contentWrapper=this.modalLayer.querySelector(S.defaults.contentWrapper),this.shader=this.modalLayer.querySelector(S.defaults.shader)}_bindContextToFunctions(){this._handleShaderClick=this._handleShaderClick.bind(this),this._handleModalLayerLinkClick=this._handleModalLayerLinkClick.bind(this),this._handleModalLayerEvents=this._handleModalLayerEvents.bind(this),this._handleEscClick=this._handleEscClick.bind(this),this._isLayerOpen=this._isLayerOpen.bind(this)}_addEvents(){document.addEventListener(E.MODAL_LAYER_OPEN_EVENT,this._handleModalLayerEvents),document.addEventListener(E.MODAL_LAYER_CLOSE_EVENT,this._handleModalLayerEvents),this.globalEventEmitter.on(t.SC_ERROR,this._handleModalLayerEvents),this.globalEventEmitter.on(E.MODAL_LAYER_OPEN_EVENT,this._handleModalLayerEvents),this.globalEventEmitter.on(E.MODAL_LAYER_CLOSE_EVENT,this._handleModalLayerEvents),this.eventDelegate.on("click",S.defaults.modalLayerLink,this._handleModalLayerLinkClick)}_removeEvents(){document.removeEventListener(E.MODAL_LAYER_OPEN_EVENT,this._handleModalLayerEvents),document.removeEventListener(E.MODAL_LAYER_CLOSE_EVENT,this._handleModalLayerEvents),this.globalEventEmitter.off(t.SC_ERROR,this._handleModalLayerEvents),this.globalEventEmitter.off(E.MODAL_LAYER_OPEN_EVENT,this._handleModalLayerEvents),this.globalEventEmitter.off(E.MODAL_LAYER_CLOSE_EVENT,this._handleModalLayerEvents),this.eventDelegate.off("click",S.defaults.modalLayerLink,this._handleModalLayerLinkClick)}_addLayerEvents(){this.shader.addEventListener("click",this._handleShaderClick),this.eventDelegate.on("keydown","body",this._handleEscClick)}_removeLayerEvents(){this.shader.removeEventListener("click",this._handleShaderClick),this.eventDelegate.off("keydown","body",this._handleEscClick)}async _handleModalLayerLinkClick(e){this.options=null,e.preventDefault();const t=e.target.closest(S.defaults.modalLayerLink),n=Object.assign({},t.dataset);n.targetElement=t;const o=await g.getLayerContent(n);this._openLayerContent(o)}async _handleModalLayerEvents(e){let t=e;if(this.options=null,e.detail&&(t=e.detail),t&&t.layerAction&&"close"===t.layerAction)this._closeLayer();else{t&&t.options&&(this.options=t.options);const e=await g.getLayerContent(t);this._openLayerContent(e)}}_handleShaderClick(){this._adjustOption("onShaderClick")&&this._closeLayer()}_handleEscClick(e){document.body.classList.contains(S.defaults.open)&&27===e.keyCode&&this._adjustOption("onEscClick")&&this._closeLayer()}_adjustOption(t){let n=e.dom.getElement(S.defaults.modalLayerOptions),o=Object.keys(n.dataset).length>0?n.dataset.layerOptions:"{}";return n=Object.assign(S.defaultOptions,JSON.parse(o)),this.options&&(n=Object.assign(S.defaultOptions,this.options)),n[t]}async _openLayerContent(e){this._isLayerOpen()?this.layerStack.push(e):(await this._hideLayerContent(this._isLayerOpen()),this._clearLayerWrapper(),this.contentWrapper.appendChild(e),this._openLayer())}_clearLayerWrapper(){this.contentWrapper.innerHTML="",this.contentWrapper.className=S.defaults.contentWrapperClassName}async close(e,t){await e.beforeClose(),this._closeLayer(t)}_closeLayer(e){e&&this.modalLayer.classList.add(S.defaults.modalLayerNoTransition),this.modalLayer.setAttribute(S.defaults.attributeState,"false"),document.body.classList.remove(S.defaults.open),this._removeLayerEvents(),this._clearLayerWrapper(),setTimeout((()=>{this.modalLayer.classList.remove(S.defaults.modalLayerNoTransition),this.modalLayer.classList.remove(S.defaults.centerVertically),this._dispatchCustomEvent("LAYER_CLOSED");const e=this.layerStack.shift();e&&this._openLayerContent(e)}),250)}async open(e,t){await e.beforeOpen(),this._openLayer(t)}_openLayer(e){e&&this.modalLayer.classList.add(S.defaults.modalLayerNoTransition),this.modalLayer.setAttribute(S.defaults.attributeState,"true"),document.body.classList.add(S.defaults.open);this._adjustOption("centerVertically")&&this.modalLayer.classList.add(S.defaults.centerVertically),this._showLayerContent();const t=this.querySelector(S.defaults.contentWrapper),n=this._adjustOption("addCssClass");t&&n&&t.classList.add(n),this._addLayerEvents(),setTimeout((()=>{this.modalLayer.classList.remove(S.defaults.modalLayerNoTransition),this._dispatchCustomEvent("LAYER_LOADED",{element:this,type:"modal_layer"})}),250)}_isLayerOpen(){return document.body.classList.contains(S.defaults.open)}async _hideLayerContent(e){return e?(this.contentWrapper.classList.add(S.defaults.contentWrapperHide),this.contentWrapper.classList.remove(S.defaults.contentWrapperShow),new Promise((e=>{setTimeout((()=>{e("opacity on content wrapper was set.")}),250)}))):Promise.resolve()}_showLayerContent(){this.contentWrapper.classList.add(S.defaults.contentWrapperShow),this.contentWrapper.classList.remove(S.defaults.contentWrapperHide)}_dispatchCustomEvent(e,t){try{let n=new CustomEvent(e,{detail:t});document.dispatchEvent(n)}catch(t){console.error("dispatchCustomEvent: ","the custom-event for "+e+" could not be dispatched",t)}}}void 0===window.customElements.get("modal-layer-wrapper")&&window.customElements.define("modal-layer-wrapper",S);const C={},T={__:C};C.oDefaults={sType:"sessionStorage"},C.normalizeOptions=function(e){let t=e||{};return"object"!=typeof t||t.type||(t.type=C.oDefaults.sType),{failsafeSet:!!t.failsafeSet,sType:"string"==typeof t?t:t.type}},C.read=function(e,t,n){const o=C.normalizeOptions(n).sType,a=JSON.parse(window[o].getItem(e));return a?a[t]:null},C.write=function(e,t,n,o){const a=C.normalizeOptions(o),r=a.sType;try{let o=window[r].getItem(e);return o=null===o?{}:JSON.parse(o),o[t]=n,o=JSON.stringify(o),window[r].setItem(e,o),!0}catch(o){return!!a.failsafeSet&&(a.failsafeSet=!1,C.write(e,t,n,a))}},C.clear=function(e,t){const n=C.normalizeOptions(t).sType;window[n].removeItem(e)},C.length=function(e,t){const n=C.normalizeOptions(t).sType,o=JSON.parse(window[n].getItem(e));let a=0;if(Object.keys&&o)a=Object.keys(o).length;else for(let e in o)o.hasOwnProperty(e)&&(a+=1);return a},T.getItem=function(e,t,n){let o=encodeURIComponent(t);return C.read(e,o,n)},T.setItem=function(e,t,n,o){let a=encodeURIComponent(t);return C.write(e,a,n,o)},T.removeItem=function(e,t,n){let o=encodeURIComponent(t);C.write(e,o,null,n)},T.clear=C.clear,T.length=C.length;const O={},v={__:O};O.oDefaults={classBodyLayerOpened:"nm-layer-opened",classHidden:"nm-hidden",classLayerShaderVisible:"nm-layer-shader-visible",classLayerVisible:"nm-layer-visible",selectorLayer:".nm-layer"},O.scrollPosition=0,v.showShader=function(){return new Promise((function(e){document.body.classList.add(O.oDefaults.classBodyLayerOpened),O.wait(20).then((function(){O.shader||O.initialize(),O.shader&&(O.shader.classList.remove(O.oDefaults.classHidden),O.shader.classList.add(O.oDefaults.classLayerShaderVisible))})).then((function(){O.wait(280).then(e)}))}))},O.wait=function(e){return new Promise((function(t){setTimeout(t,e)}))},v.hideShader=function(){return new Promise((function(e){document.body.classList.remove(O.oDefaults.classBodyLayerOpened),O.shader.classList.remove(O.oDefaults.classLayerShaderVisible),O.shader.classList.add(O.oDefaults.classHidden),e(O.shader)}))},O.findCurrentLayerOfType=function(t){const n=e.dom.getElement(O.oDefaults.selectorLayer+'[data-layer-type="'+t+'"]');return e.dom.closest(n,".nm-layer-wrapper")},v.open=function(t,n){let o,a;return t&&n?(o=document.body.appendChild(t),a=e.dom.isElement(O.oDefaults.selectorLayer)?v.showShader().then((function(){return O.openLayer(o,n)})):O.openLayer(o,n)):a=Promise.reject(new TypeError('"element"')),a},O.openLayer=function(t,n){return new Promise((function(o){o(n),O.wait(20).then((function(){const o=e.dom.getElement(O.oDefaults.selectorLayer,t);o.classList.add(O.oDefaults.classLayerVisible),o.setAttribute("data-layer-type",n.type)})),O.wait(530).then((function(){document.body.classList.add("nm-"+n.type+"-layer-opened")}))}))},v.close=function(t,n){let o,a;return t&&n?(o=e.dom.getElement(O.oDefaults.selectorLayer,t),e.dom.isElement(o)&&(o.classList.remove(O.oDefaults.classLayerVisible),o.removeAttribute("data-layer-type")),a=O.wait(500).then((function(){return e.dom.isElement(t)?(e.dom.removeElement(t),document.body.classList.remove("nm-"+n.type+"-layer-opened"),Promise.resolve(n)):Promise.reject("element to be removed is missing!!!")}))):a=Promise.reject(new TypeError('"element"')),a},v.toggleShader=function(){O.isShaderNotNeeded()?v.hideShader():console.info("Shader remains visible")},O.isShaderNotNeeded=function(){return 0===O.getVisibleLayers().length},O.isLastVisibleLayer=function(){return 1===O.getVisibleLayers().length},O.getVisibleLayers=function(){return e.dom.getElementsArray(O.oDefaults.selectorLayer+"."+O.oDefaults.classLayerVisible)},v.replace=function(t,n){let o,a,r,s;return s=t&&n?new Promise((function(s,i){o=n.type,a=O.findCurrentLayerOfType(o),e.dom.isElement(a)?(a.classList.remove(O.oDefaults.classLayerVisible),r=document.body.appendChild(t),O.wait(500).then((function(){const t=e.dom.getElement(O.oDefaults.selectorLayer,r);t.classList.add(O.oDefaults.classLayerVisible),t.setAttribute("data-layer-type",n.type)})),document.body.classList.add("nm-"+n.type+"-layer-opened"),O.wait(530).then((function(){document.body.removeChild(a),s(n)}))):i(new TypeError("noLayer of type "+n.type))})):Promise.reject(new TypeError('"element"')),s},O.initialize=function(){e.dom.isElement(".nm-layer-shader")||(document.body.insertAdjacentHTML("beforeend",'<div class="nm-layer-shader nm-hidden"></div>'),O.shader=e.dom.getElement(".nm-layer-shader"))},O.initialize();const A={},R={__:A};A.BASE_CLASS="nm-layer-wrapper",A.loadedScripts=[],R.create=function(e){let t,n;return t=document.createElement("div"),t.className=A.BASE_CLASS,A.globalEval(e),t.innerHTML=e,n=t.firstChild,n.className&&n.classList.contains(A.BASE_CLASS)?n:t},R.update=function(e,t){return A.globalEval(t),e.innerHTML=t,!0},A.globalEval=function(t){let n,o;n=document.createElement("div"),n.insertAdjacentHTML("beforeend",t.trim()),o=e.dom.getElementsArray("script",n),o.length&&(window.asyncLoadingJS=!1,A.evalScripts(o))},A.evalScripts=function(e){let t,n,o,a,r=eval;for(;e.length;)n=e.splice(0,1),o=n[0],a=o.text.indexOf("use strict")>-1,o.getAttribute("src")?A.evalSingleScript(n):a?(n=document.createElement("script"),n.text=o.text,t=document.head||document.getElementsByTagName("head")[0],t.appendChild(n).parentNode.removeChild(n)):r(o)},A.evalSingleScript=function(t){const n=t[0],o=n.text.indexOf("use strict")>-1,a=n.getAttribute("src");window.asyncLoadingJS?setTimeout((function(){A.evalSingleScript(t,o)}),100):A.loadedScripts.indexOf(a)<0&&(A.loadedScripts.push(a),window.asyncLoadingJS=!0,e.jsLoader.loadURL(a,n).then((function(){window.asyncLoadingJS=!1})).catch((function(){window.asyncLoadingJS=!1})))};const w={},P={__:w};w.layers={},w.Layer=function(e,t,n){return this.type=e,this.html=t,this.element=R.create(t),this.onCloseRequest=n,this},w.Layer.prototype.close=function(){return w.closeLayer(this)},w.Layer.prototype.update=function(e){this.element=R.create(e),this.html=e},w.Layer.prototype.getElement=function(){return this.element},w.Layer.prototype.remove=function(){delete w.layers[this.type],this.element=null,this.onCloseRequest=null,this.html=null,this.type=null},P.initialize=function(e){w.eventBus=e,w.addEvents()},w.addEvents=function(){e.dom.getEventDelegate("body").off("click",".nm-layer-wrapper",P.wrapperClickHandler),e.dom.getEventDelegate("body").on("click",".nm-layer-wrapper",P.wrapperClickHandler)},P.wrapperClickHandler=function(e){w.nrOfLayers()>0&&w.isShaderClicked(e)&&P.requestCloseall()},P.open=function(e,t,n){let o;return e?t?w.hasActiveLayer(e)?"cms"===e||"conflict-layer"===e?(o=new w.Layer(e,t,n),w.updateLayer(o,t)):"jslayer"===e?Promise.resolve(w.layers.jslayer):Promise.reject(new Error("Duplicate layer type. "+e)):n&&"function"!=typeof n?Promise.reject(new Error("onCloseRequest has to be a function.")):(o=new w.Layer(e,t,n),w.layers[e]=o,w.openLayer(o)):Promise.reject(new Error("html not set.")):Promise.reject(new Error("type not set."))},w.hasActiveLayer=function(e){return!!w.layers[e]},w.nrOfLayers=function(){let e,t=0;for(e in w.layers)w.layers.hasOwnProperty(e)&&t++;return t},P.requestCloseall=function(){let e;for(e in w.layers)w.layers.hasOwnProperty(e)&&w.requestCloseLayer(e)},w.requestCloseLayer=function(e){const t=w.layers[e];"function"==typeof t.onCloseRequest?t.onCloseRequest():w.closeLayer(t)},w.openLayer=function(e){const n=e;return v.open(e.element,e).then((function(e){return w.dispatchEvent(t.LAYER_LOADED,{element:e.element}),w.dispatchCustomEvent("LAYER_LOADED",{element:e.getElement(),type:"layer"}),e})).catch((function(e){throw w.closeLayer(n),console.error("core/layer/animation:layerOpen: animation rejected.",e),e}))},w.dispatchEvent=function(e,t){w.eventBus.emit(e,t)},w.dispatchCustomEvent=function(e,t){try{let n=new CustomEvent(e,{detail:t});document.dispatchEvent(n)}catch(t){console.error("dispatchCustomEvent: ","the custom-event for "+e+" could not be dispatched",t)}},w.closeLayer=function(e){return v.close(e.element,e).then((function(e){e.remove()}),(function(e){throw console.warn("core/layer/animation:layerClose: animation rejected.",e),e})).catch((function(e){console.error(e)})).then(v.toggleShader).then((function(){w.dispatchEvent(t.LAYER_CLOSED,{element:e.element}),w.dispatchCustomEvent("LAYER_CLOSED")}))},w.updateLayer=function(e,n){let o;return e.update(n),o=v.replace(e.getElement(),e),o.then((function(e){return w.dispatchEvent(t.LAYER_LOADED,{element:e.getElement()}),w.dispatchCustomEvent("LAYER_LOADED",{element:e.getElement(),type:"layer"}),e})).catch((function(e){throw console.warn("core/layer/animation:layerUpdate: animation rejected."),e}))},w.isShaderClicked=function(t){return e.dom.isElementOutsideOfElementWithSelector(t.target,".nm-layer-inner")&&t.target.classList.contains("nm-layer-wrapper")};const D=function(e,t){this.pathname=e||"",this.hash=t||"",this.changes=[],this.init()};D.URL_PARAM_SEPARATOR="&",D.URL_PAGE_SEPARATOR="~_~",D.VERSION="0.2.1",D.prototype.init=function(e,t){let n;for(n in t&&(this.hash=t),this.hashObjects=this.parseHash(this.hash),this.attrs={},this.hashObjects)"page"===n?this.hashObjects.page!==this.pathname&&this.changes.push([n,this.hashObjects[n],1]):n.match(/^data/g)?this.attrs[n]=this.hashObjects[n]:this.changes.push([n,this.hashObjects[n],1])},D.prototype.update=function(e){let t,n,o=this.hashObjects;for(n in this.hash=e,this.hashObjects=this.parseHash(e),this.changes=[],this.currentAttrs=this.attrs||{},this.attrs={},this.hashObjects)n.match(/^data/g)?this.attrs[n]=this.hashObjects[n]:this.hashObjects[n]!==o[n]&&this.changes.push([n,this.hashObjects[n],1]);for(t in o)this.hashObjects[t]||"page"===t||this.changes.push([t,o[t],0]);!this.hashObjects.page&&o.page&&(this.hashObjects.page=this.pathname,this.changes.push(["page",this.pathname,1]))},D.prototype.parseHash=function(e){let t,n,o,a,r,s,i,l={};if(t=e||"",t.match(/^#/)&&(t=t.substring(1)),t){n=t.split(D.URL_PAGE_SEPARATOR),a=n.length;let e,c=/\+/g,d=/([^&=]+)=?([^&]*)/g;const u=function(e){return decodeURIComponent(e.replace(c," "))};for(o=0;s=n[o],o<a;o++)for(;null!==(e=d.exec(s));)r=u(e[1]),i=u(e[2]),l[r]=i}return l},D.prototype.getChanges=function(){const e=this.changes;return this.changes=[],e},D.prototype.getAttrs=function(){return this.attrs||{}},D.prototype.getCurrentAttrs=function(){return this.currentAttrs||{}};const b={},k={__:b};let N=!1,I=null,F=!1;b.pathBase="",k.history_available=!(!window.history||!history.pushState),b.registered=[],b.newHashString=function(e,t,n,o,a){let r,s;const i=o||"open",l=a||{};return t?(r=b.state.parseHash(e),"close"===i?void 0!==r[t]&&delete r[t]:r[t]=n,s=b.processHashKeys(r,i),s=b.addAttrsToHashParts(s,l),s=b.removeAttrsFromHashParts(s,l),b.joinHashParts(s,e)):e},b.processHashKeys=function(e,t){const n=[];let o,a;for(o in e)if(e[o]){if("close"===t&&o.match(/data-/))continue;if("page"===o){history.pushState({pageLoad:!0},null,e[o]),b.updatePathBase(),b.handleHistoryChange({state:{pageLoad:!0}});continue}a=e[o],a&&n.push(o+"="+a)}return n},b.addAttrsToHashParts=function(e,t){const n=e;let o,a;for(o in t)t[o]&&(a="data-"+o+"="+t[o],n&&-1===n.indexOf(a)&&n.push("data-"+o+"="+t[o]));return n},b.removeAttrsFromHashParts=function(e,t){const n=e;let o,a,r;for(o in t)t[o]||(a="data-"+o+"=true",n&&n.indexOf(a)>-1&&(r=n.indexOf(a),n.splice(r,1)));return n},b.joinHashParts=function(e,t){let n;return n=new RegExp(D.URL_PAGE_SEPARATOR).test(t)?e.join(D.URL_PAGE_SEPARATOR):e.join(D.URL_PARAM_SEPARATOR),n},b.getChannelAttributes=function(e,t){let n,o,a,r={};for(a=e.attributes.length-1;a>-1;a--)o=e.attributes[a].nodeName,o.match(/^data/)&&o.match(t)&&(n=o.replace(/^data-/,""),r[n]=e.attributes[a].nodeValue);return r},b.publishChanges=function(e,n,o){let a,r,s,i,l,c,d;for(c=0,d=e.length;c<d;c++)a=e[c],"page"===a[0]?(s=0===a[2]?location.pathname:a[1],b.eventBus.emit(t.PAGE_OPEN,{pathname:s})):(r=0===a[2]?".close":".open",i={},i[a[0]]=a[1],l=a[0]+r,b.eventBus.emit(l,[i,n,o]))},b.hashIsEmpty=function(e){let t="";return e&&(t=e),0===t.length},b.stringContainsRegexPattern=function(e,t){return t.test(e)},b.hasInvalidHashParam=function(e){const t=/(^\s*\/\/|:\/\/)/gi;let n=!1,o=e;return o&&(o.indexOf("=")>0&&(o=o.split("=")[1]),n=b.hashIsEmpty(o),n=!0===n||b.stringContainsRegexPattern(decodeURIComponent(o),t)),n},b.tryHashUpdate=function(e){F=!1,b.eventBus.emit(t.PAGE_LEAVE),F||(e?(N=!1,location.hash=e):(N=window.pageYOffset,location.hash&&""!==location.hash&&(location.hash="")),I=location.hash)},b.createState=function(e,t){return new D(e||"",t||"")},b.handleHistoryChange=function(e){e.state&&e.state.pageLoad&&b.publishChanges([["page",location.pathname,0]],[],[])},b.isInpageNaviPresent=function(){const e=SETUPS.get("nemo.nav.navSelector")+" a",t=[].slice.call(document.querySelectorAll(e)),n=[].slice.call(document.querySelectorAll(".nm-pageOpen"));return t.length>0||n>0},b.updatePathBase=function(){b.pathBase=window.location.pathname.split("/"),b.pathBase.pop(),b.pathBase.push(""),b.pathBase=b.pathBase.join("/"),b.pathBase=b.pathBase.split(" ").join(""),SETUPS.set("nemo.core.router.pathBase",b.pathBase)},b.handleHashChange=function(){let e;if(b.hasInvalidHashParam(location.hash))return console.error("invalid hash param",location.hash),b.eventBus.emit(t.ERROR),location.hash=location.hash.split("#")[0],!1;e=location.hash.split("#")[1]||"",e&&(e="#"+e),N&&(window.scrollTo(0,N),I!==e&&(N=!1)),b.eventBus.emit(t.HASH_CHANGE,e),b.state.update(e),b.publishChanges(b.state.getChanges(),b.state.getAttrs(),b.state.getCurrentAttrs())},b.reset=function(){b.state=this.createState(location.pathname,""),b.registered=[]},b.addUrlSelector=function(e,t){const n=e.lastIndexOf(".html");return e.substring(0,n)+"."+t+e.substring(n)},b.getPreviousPageData=function(e){return{hash:e.hash,hashIdentifier:e.hash&&e.hash.indexOf("page=")>=0?"page":"",hashShort:e.hash&&e.hash.indexOf("page=")>=0?e.hash.split("page=")[1]:"",pathName:e.pathname,url:e.pathname+e.hash}},b.getClosestATag=function(t){let n;return n="A"===t.target.tagName?t.target:e.dom.closest(t.target,"a"),n},k.register=function(t,n,o){const a=o||"open";b.registered.push([t,n,a]),console.info("ROUTER.register++++ selector: "+t+", keyName: "+n+", action: "+a),b.legacyEventBus=e.dom.getEventDelegate("body"),b.legacyEventBus.on("click",t,b.handleRegisteredClicks(n,a))},b.isClickHandlerExitConditionFulfilled=function(t){const n=t;let o,a=!1;return e.dom.getElementsArray("body.nm-layer-iframelayer").length&&(console.info("IframelayerFallback-Mode"),e.dom.isElement(n)&&n.classList.contains("nm-layerLink")&&(o=n.getAttribute("href"),o.indexOf(".iframelayer.")<0&&(o=b.addUrlSelector(o,"iframelayer"),n.setAttribute("href",o)),a=!0)),(e.dom.isElement(n)&&n.classList.contains("js-link-extern")||e.dom.getElementsArray("body.nm-layer-fallback").length)&&(a=!0),a},b.handleRegisteredClicks=function(t,n){return function(o){let a,r,s,i=this,l=b.getClosestATag(o);if(b.isClickHandlerExitConditionFulfilled(l))return!0;o.preventDefault(),o.target.classList.contains("j-stop-propagation")&&o.stopPropagation(),a=i.getAttribute("href")?i.getAttribute("href"):i.getAttribute("data-href"),r=b.getChannelAttributes(i,t),a||(s=e.dom.closest(o.target.parentNode,"a"),a=s?s.getAttribute("href"):""),r=b.handleInnerLayerChannelAttributes(o,r),b.previousPage=b.getPreviousPageData(window.location),b.tryHashUpdate(b.newHashString(location.hash,t,a,n,r))}},b.handleInnerLayerChannelAttributes=function(e,t){const n=t;return n.innerlayer=!1,b.shouldSetTabLayerChannelAttribute(e)&&(n.innerlayer="true"),n},b.shouldSetTabLayerChannelAttribute=function(t){const n=e.dom.closest(t.target,".nm-navigation-layer-wrap .nm-navigation-derivative-sub-list"),o=e.dom.closest(t.target,".nm-layer-content .nm-navigation"),a=e.dom.closest(t.target,".nm-gallery-slides .nm-icon-next-arrow"),r=e.dom.closest(t.target,".nm-gallery-slides .nm-icon-back-arrow");let s=!1;return(n||o||a||r)&&(s=!0),s},k.open=function(e,t){b.tryHashUpdate(b.newHashString(location.hash,e,t,"open"))},k.close=function(e,t){b.tryHashUpdate(b.newHashString(location.hash,e,t,"close"))},k.getPreviousPage=function(){return b.previousPage?b.previousPage:null},k.getState=function(){return b.state},k.getRegistered=function(){return b.registered},k.getPathBase=function(){return b.pathBase||""},k.initialize=function(e){let n;if(b.eventBus=e,window.addEventListener("popstate",b.handleHistoryChange),window.addEventListener("hashchange",b.handleHashChange,!1),b.hasInvalidHashParam(location.hash))return console.error("invalid hash param",location.hash),b.eventBus.emit(t.ERROR),location.hash=location.hash.split("#")[0],!1;b.state=b.createState(location.pathname,location.hash),n=function(){b.publishChanges(b.state.getChanges(),b.state.getAttrs(),b.state.getCurrentAttrs()),!location.hash&&b.isInpageNaviPresent()&&history.replaceState({pageLoad:!0},null,location.href)},window.setTimeout(n,100),b.updatePathBase()};const U={},x={__:U};U.callbacks={},U.layer=null,U.pending=null,U.openLayersSinceLastClose=0,x.initialize=function(e){U.eventBus=e,U.registerAtRouter(),U.registerEvents()},x.register=function(e,t){U.callbacks[e]=t,U.pending&&2===U.pending.length&&U.pending[0]&&e===U.pending[0]&&U.processLayer(e,U.pending[1])},U.registerAtRouter=function(){k.register(".nm-jslayerLink","jslayer"),k.register(".nm-j-jslayer .nm-button-close","jslayer","close"),k.register(".nm-j-jslayer .nm-j-layer-close-button","jslayer","close")},U.registerEvents=function(){U.eventBus.on("jslayer.open",U.handleJslayerOpen),U.eventBus.on("jslayer.close",U.handleJslayerClose),U.domDelegate=e.dom.getEventDelegate("body"),U.domDelegate.on("click",".nm-j-jslayer .nm-button-back",U.handleBackClick)},U.handleJslayerOpen=function(e){let t,n,o,a=e[0]&&e[0].jslayer?e[0].jslayer:null;a&&(a.indexOf("#")>-1&&(a=a.split("#")[1]),t=n=a,a.indexOf(".")>-1&&(o=a.split("."),t=o[0],n=o[1]),U.callbacks[t]&&"function"==typeof U.callbacks[t]?U.processLayer(t,n):U.pending=[t,n])},U.processLayer=function(e,t){const n=U.callbacks[e].call({},t);P.open("jslayer",n,U.handleCloseRequest).then((function(n){U.layer=n,U.layer.key=e,U.layer.id=t,U.openLayersSinceLastClose+=1,U.openLayersSinceLastClose>1?U.layer.element.classList.add("nm-jslayer-show-backbutton"):U.layer.element.classList.remove("nm-jslayer-show-backbutton")}),(function(e){console.warn("jslayer.handleJslayerOpen:",e)}))},U.handleCloseRequest=function(){let e=U.layer.key;U.layer.id&&(e=e+"."+U.layer.id),k.close("jslayer",e),U.openLayersSinceLastClose=0},U.handleBackClick=function(){U.openLayersSinceLastClose-=2,history.back()},U.handleJslayerClose=function(){U.layer&&U.layer.close&&(U.layer.close(),U.eventBus.emit(t.LAYER_CLOSE,{element:U.layer.element}),U.pending=null,U.openLayersSinceLastClose=0)};const M={},B={__:M};M.registeredPatterns={},M.JS_LAYER_REGEX=/(jslayer:)(\w|\.|-|_)+(,)?/gi,B.getContent=function(e){return M.getLayerContent(e)},B.isStaticContentRequest=function(e){return M.isStaticLayerRequest(e)},M.isStaticLayerRequest=function(e){return!!e.match(M.JS_LAYER_REGEX)},M.parseParams=function(e){const t={};let n;return n=(e||"").replace(M.JS_LAYER_REGEX,""),n.split(",").forEach((function(e){const n=e.split("=");t[n[0]]=n[1]})),t},M.parsePattern=function(e){const t=(e||"").match(M.JS_LAYER_REGEX);return t?t[0].split(",")[0]:null},M.getLayerContent=function(e){const t=M.parseParams(e),n=M.parsePattern(e);let o;return o=B.isRegisterPattern(n)?M.registeredPatterns[n](t):Promise.reject("pattern "+n+" id not registered!!"),o},B.registerStaticRequest=function(e,t){M.registeredPatterns[e]=t},B.isRegisterPattern=function(e){return!!M.registeredPatterns[e]&&"function"==typeof M.registeredPatterns[e]};const H={},j={__:H};H.oIndex={},H.iCounterXhr=0,H.aCacheURI=[],H.iParallelXHRMax=3,H.sMarkerXHR=".headless",H.oMarkerProvider=[],H.registeredContentProviders=[],H.DYNAMIC_URL_PREFIX_REGEX=/js(-|_)link/g,H.updateIndex=function(e,t){const n=encodeURIComponent(e);t?H.oIndex[n]=!0:(H.oIndex[n]=!1,delete H.oIndex[n])},j.isCached=function(e){const t=encodeURIComponent(e);return!!H.oIndex[t]},j.setContent=function(e,t,n){const o=T.setItem("core.controller.content",e,t,{failsafeSet:n});o||j.flush(),H.updateIndex(e,o)},H.hasDynamicContentUrl=function(e){return(e||"").match(H.DYNAMIC_URL_PREFIX_REGEX)},j.getContent=function(e,t){let n,o;return H.hasDynamicContentUrl(e)?(o=H.getDynamicContentProvider(e),o?H.getContentFromProvider(o,e):Promise.reject(new Error("no registered content provider has been found for this url: "+e))):B.isStaticContentRequest(e)?B.getContent(e):(n=T.getItem("core.controller.content",e,t),j.isCached(e)&&n?Promise.resolve(T.getItem("core.controller.content",e,t)):H.loadRemoteContent(e,t))},j.fillCache=function(e){let t=0;for(;t<e.length;t++)j.isCached(e[t])||H.aCacheURI.push({sKey:e[t]});H.processCacheURIs()},H.processCacheURIs=function(){let e;0!==H.aCacheURI.length&&(H.iCounterXhr<H.iParallelXHRMax&&(e=H.aCacheURI.shift(),H.loadRemoteContent(e.sKey,!0)),H.aCacheURI.length>0&&window.setTimeout(H.processCacheURIs,50))},j.registerContentProvider=function(e){const t={};e&&e.regEx&&"function"==typeof e.regEx.exec&&e.callbackPromise&&"function"==typeof e.callbackPromise?(t.regEx=e.regEx,t.callbackPromise=e.callbackPromise,t.name=e.name||"provider#"+H.registeredContentProviders.length,H.registeredContentProviders.push(t)):console.warn("invalid params!could not register content Provider")},H.getDynamicContentProvider=function(e){const t=H.registeredContentProviders.filter((function(t){return!!e.match(t.regEx)}));return t.length?t[0]:null},H.getContentFromProvider=function(e,t){const n=e.callbackPromise(t);return"function"==typeof n.then?n:Promise.reject(new Error("invalid content provider"))},j.registerMarkerProvider=function(e){"function"==typeof e&&H.oMarkerProvider.indexOf(e)<0&&H.oMarkerProvider.push(e)},H.rewriteUrl=function(e){const t="."+e.split("#")[0].split("?")[0].split(".").pop(),n=[];let o="",a=!1;return H.oMarkerProvider.forEach((function(t){n.push(t(e))})),Promise.all(n).then((function(e){return e.forEach((function(e){e.marker&&!a&&(o+="."+e.marker,e.overwrites&&(o="."+e.marker,a=!0))})),o})).then((function(n){return e.split(t).join(n+H.sMarkerXHR+t)})).catch((function(t){return console.warn(t),e}))},H.loadRemoteContent=async function(e,t){try{const n=await H.rewriteUrl(e);H.iCounterXhr+=1;const o=(e=>{if(e.status>=200&&e.status<300)return e;{let t=new Error(e.statusText);throw t.response=e,t}})(await fetch(n)),a=await o.text();return(e=>{window.ADRUM&&window.ADRUM.command&&e.indexOf("component_error")>-1&&window.ADRUM.command("addUserData","component-error","true")})(a),t&&j.setContent(e,a),a}catch(e){return console.warn("loadRemoteContent failed",e),e}finally{H.iCounterXhr-=1}},j.flush=function(e){let t,n,o,a=e||[],r=[];if(0===a.length)H.oIndex={},T.clear("core.controller.content","sessionStorage");else{for(t in H.oIndex)H.oIndex.hasOwnProperty(t)&&(o=decodeURIComponent(t),H.oIndex[t]&&-1===a.indexOf(o)&&r.push(o));for(n in r)r.hasOwnProperty(n)&&(T.removeItem("core.controller.content",r[n]),H.updateIndex(r[n],!1))}},H.initialize=function(){j.flush()},j.debug=function(){return{cacheItems:H.aCacheURI,cacheLenght:H.aCacheURI.length}},j.initialize=function(){H.initialize()};const V={__:{},requiresDynamicDot:function(){return null==document.querySelector("#nm-id-default-layer-tpl")},getTemplateFromBackend:function(e){return new Promise((function(t,n){let o=SETUPS.get("nemo.market.homepage");if(!o){const e=window.location.pathname.lastIndexOf(".");o=window.location.pathname.substring(0,e)}fetch(o+".dot-template."+e+".html",{headers:{Accept:"text/plain"},method:"GET"}).then((function(e){if(e.ok)return e.text();throw new Error(e.error)})).then((function(e){t(e?e.trim():e)})).catch((function(e){console.error("Error while reading layer template",e),n(e)}))}))}},Y='\n\t<div class="nm-layer-wrapper nm-layer-wrapper-dialogue">\n\t\t<div class="nm-layer nm-layer-dialogue nm-error-layer nm-layer-visible">\n\t\t\t<div class="nm-layer-inner">\n\t\t\t\t<div class="nm-layer-dialogue-content clearfix">\n\t\t\t\t\t<h1 class="nm-el-hdl nm-el-hdl-02 nm-at-hdl-b">{{=it.errorHeadline}}</h1>\n\t\t\t\t\t<p class="nm-error nm-error-layer-message nm-el-pg nm-el-pg-03 nm-at-pg-indicator" style="float:none;" data-defaultErrorMessage="{{=window.i18n[\'error-layer.unknown-error\']}}">{{=it.errorMessage}}</p>\n\t\t\t\t\t<div class="nm-layer-btn-ok"><a class="nm-el-btn nm-el-btn-01 nm-j-ok-btn" href="#">{{=window.i18n[\'ok-label\']}}</a></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n',q={},G={__:q};q.LAYER_TPL_ID="nm-id-default-data-layer-tpl",q.defaultLayerType="cms",q.templateStr=null,q.layer=null,q.nextLayerData=null,q.openLayersSinceLastClose=0,q.openLayersSinceLastTab=0,q.closeButtonHistoryBackTarget=-1,q.backButtonEl=null,q.scrollStackingIndex=0,q.stackingDirections={downwards:"oneLessLayer",upwards:"onMoreLayer"},q.layerStackingDirection=q.stackingDirections.upwards,q.scrollPositionStackingArray=[],q.debugActive=!1,G.initialize=function(t){q.eventBus=t,q.domEventDelegate=e.dom.getEventDelegate("body"),q.addEvents(),q.registerAtRouter()},q.addEvents=function(){q.eventBus.on(t.LAYER_OPEN,q.handleLayerOpen),q.eventBus.on(t.LAYER_CLOSE,q.handleLayerClose)},q.registerAtRouter=function(){k.register(".nm-layerLink","layer"),k.register(".nm-layer .nm-button-close","layer","close"),k.register(".nm-layer .nm-button-cancel","layer","close"),k.register(".nm-layer .nm-j-layer-close-button","layer","close"),k.register(".nm-layerClose","layer","close")},q.handleLayerOpen=function(e){this&&"function"==typeof this.preventDefault&&this.preventDefault(),q.nextLayerData=[e[0].layer,e[1],e[2]],e[1]["data-innerlayer"]?(q.closeButtonHistoryBackTarget--,q.openLayersSinceLastTab=0):(q.openLayersSinceLastClose+=1,q.openLayersSinceLastTab+=1,q.storeScrollStackingPosition()),q.startNewLayerProcess()},q.layerCloseHandler=function(e){e.preventDefault&&e.preventDefault(),P.requestCloseall(),q.domEventDelegate.off("click",".nm-error-layer .nm-j-ok-btn",q.layerCloseHandler),q.scrollStackingIndex=1,q.layerStackingDirection=q.stackingDirections.downwards},q.handleCloseRequest=function(){k.close("layer",q.layer.url),q.scrollStackingIndex=1,q.debugScrollStacking("closeRequest",q.scrollStackingIndex)},q.controlBackButton=function(e){const t=e.getElement();let n,o;t&&(o=t.querySelector(".nm-button-close"),n=t.querySelector(".nm-innerlayer-close"),o||(o=t.querySelector(".nm-j-layer-close-button"),n=t.querySelector(".nm-j-innerlayer-close-button")),q.openLayersSinceLastClose>1?q.enableTabsCloseButton(o,n):q.disableTabsCloseButton(o,n))},q.enableTabsCloseButton=function(e,t){e.style.display="none",t&&(t.style.display="inline-flex",t.addEventListener("click",q.handleLayerBack))},q.disableTabsCloseButton=function(e,t){e.style.display="inline-flex",t&&(t.style.display="none",t.removeEventListener("click",q.handleLayerBack))},q.handleLayerBack=function(e){let t;e.stopPropagation(),-1!==q.closeButtonHistoryBackTarget&&0===q.openLayersSinceLastTab?(t=q.closeButtonHistoryBackTarget,history.go(t)):(history.back(),q.openLayersSinceLastTab-=1),q.closeButtonHistoryBackTarget=-1,q.openLayersSinceLastClose>2?q.openLayersSinceLastClose-=1:q.openLayersSinceLastClose-=2,q.layerStackingDirection=q.stackingDirections.downwards,q.debugScrollStacking("handleBack",q.scrollStackingIndex),q.checkCookieLayer()},q.handleLayerClose=function(){if(this&&"function"==typeof this.preventDefault&&this.preventDefault(),q.openLayersSinceLastClose=0,q.openLayersSinceLastTab=0,q.closeButtonHistoryBackTarget=-1,q.layerStackingDirection=q.stackingDirections.downwards,!q.layer)return!1;q.layer.close().then((function(){q.layer=void 0,q.startNewLayerProcess(),q.setScrollStackingPosition(),q.checkCookieLayer()}),(function(e){console.error(e)}))},q.checkCookieLayer=function(){const e=document.querySelector("body"),t=e.classList.contains("nm-ensBanner-isVisible");e.classList.contains("nm-ensBanner-isVisible--showLegalLayers")&&t&&e.classList.remove("nm-ensBanner-isVisible--showLegalLayers")},q.startNewLayerProcess=function(){let t,n;if(!q.nextLayerData)return;t=q.nextLayerData[0],n=q.nextLayerData[1],q.nextLayerData=null;const o=q.getTemplatePromise(n),a=j.getContent(t,!1);Promise.all([o,a]).then((function(n){let[o,a]=n;-1!==a.indexOf("<html")&&q.handleError();const r=e.template.render(o,{content:a});if(!q.layer||"cms"===q.layer.type)return P.open("cms",r,q.handleCloseRequest).then((function(e){q.layer=e,q.layer.url=t,q.controlBackButton(q.layer),q.setScrollStackingPosition()})).catch((function(e){console.error(e)}));console.warn("could not Open Layer")})).catch((e=>{console.error("An error occured",e),q.handleError(e)}))},q.storeScrollStackingPosition=function(){const e=document.querySelector(".nm-layer-wrapper"),t=!!e&&"fixed"===getComputedStyle(e).position,n=q.scrollStackingIndex>=1,o=t&&n?e.scrollTop:window.pageYOffset||0;q.layerStackingDirection===q.stackingDirections.upwards&&(q.scrollPositionStackingArray[q.scrollStackingIndex]=o,q.scrollStackingIndex++),q.debugScrollStacking("storePosition",q.scrollStackingIndex-1)},q.setScrollStackingPosition=function(){const e=document.querySelector(".nm-layer-wrapper"),t=!!e&&"fixed"===getComputedStyle(e).position,n=q.scrollStackingIndex>=1,o=t&&n;q.layerStackingDirection===q.stackingDirections.downwards?(q.scrollStackingIndex--,q.scrollToStoredPosition(o,e,q.scrollPositionStackingArray[q.scrollStackingIndex]),q.layerStackingDirection=q.stackingDirections.upwards):(q.scrollToStoredPosition(o,e,0),q.scrollPositionStackingArray[q.scrollStackingIndex]=0),q.debugScrollStacking("setPosition",q.scrollStackingIndex)},q.scrollToStoredPosition=function(e,t,n){e?t.scrollTop=n:window.scroll(0,n)},q.debugScrollStacking=function(e,t){q.debugActive&&(console.info("StackingAction: ",e),console.info("StackingIndex: ",t),console.info("ScrollPosition: ",q.scrollPositionStackingArray[t]),q.layerStackingDirection===q.stackingDirections.upwards?console.info("StackingDirection set to: Upwards (default)"):console.info("StackingDirection set to: Downwards"),console.info("------------------------------------------------"))},q.getTemplatePromise=function(e){return V.requiresDynamicDot()?q.getTemplateFromBackend(e):q.getTemplateString(e)},q.getTemplateFromBackend=function(e){let t=null;return t=e&&e["data-layer-tpl"]?"nm-id-"+e["data-layer-tpl"]+"-layer-tpl":q.LAYER_TPL_ID,V.getTemplateFromBackend(t)},q.getTemplateString=function(e){let t,n="#"+q.LAYER_TPL_ID;return e&&e["data-layer-tpl"]&&(n="#nm-id-"+e["data-layer-tpl"]+"-layer-tpl"),t=document.querySelector(n),Promise.resolve(t.innerHTML||"")},q.handleError=function(){let t;t=e.template.render(Y,{errorMessage:window.i18n["error-layer.unknown-error"]||"Es ist ein unbekannter Fehler aufgetreten"}),P.open("error",t).then((function(){q.domEventDelegate.on("click",".nm-error-layer .nm-j-ok-btn",q.layerCloseHandler)})).catch((function(e){console.error(e)})),history.back()};const W={__:{},setPageTitle:function(e){document.title=e},extractLayerTitle:function(t){const n=t?e.dom.getElement(".nm-layer-title",t):null;let o="";return null!==n&&(o=n.innerHTML),o}},z={},X={__:z};z.addEvents=function(){z.eventBus.on(t.LAYER_LOADED,z.handerLayerLoaded),z.eventBus.on(t.LAYER_CLOSED,z.handerLayerClosed)},z.handerLayerClosed=function(){const t=e.dom.getElement("#nm-page-title");t&&null!==t&&z.updateTitle(t.innerHTML)},z.handerLayerLoaded=function(e){let t;e&&e.element&&(t=W.extractLayerTitle(e.element),z.updateTitle(t))},z.updateTitle=function(e){let t,n;e&&""!==e&&(t=document.createElement("div"),t.innerHTML=e,n=t.firstChild.nodeValue,W.setPageTitle(n))},X.initialize=function(e){z.eventBus=e,z.addEvents()};const J="\n\t{{? SETUPS.get('nemo.footnote-engine.active') === true}}\n\t\t{{? !SETUPS.get('scopes.nemo.DISABLE_FEATURE_HUB') && SETUPS.get('scopes.nemo.ONEFOOTER_FA_INCLUDE') && SETUPS.get('nemo.fefa.scOneFootnoteJsonUrl') && SETUPS.get('nemo.FefaFeatureAppVersion')}}\n\t\t\t<feature-app id=\"audi-footnote-engine-layer-"+Math.floor(1e6*Math.random())+'" {{? /^https?:/gi.test(SETUPS.get(\'nemo.FefaFeatureAppVersion\')) }}\n\t\tsrc="{{=SETUPS.get(\'nemo.FefaFeatureAppVersion\')}}"\n\t{{??}}\n\tsrc="https://oneaudi-fa-footnote-engine.cdn.prod.arcade.apps.one.audi/{{=SETUPS.get(\'nemo.FefaFeatureAppVersion\')}}/fh/app.js"\n\t{{?}}\n\t config=\'{"apiUrls": ["{{=SETUPS.get(\'nemo.fefa.scOneFootnoteJsonUrl\')}}"], "omitSideSpacing": "true", "uiTheme": "light"}\'></feature-app>\n\t\t{{??}}\n\t\t\t<audi-footnotes class="audi-footnotes sc-footnotes" data-module="footnotes">\n\t\t\t\t<ul class="audi-footnotes-list"></ul>\n\t\t\t</audi-footnotes>\n\t\t{{?}}\n\t{{?}}\n',Z={},K={__:Z};Z.navURLs=null,Z.oDefaults={nmContentWrapper:".nm-wrapper-content",sClassAnimate:"animate",sClassDirectionBackward:"backward",sClassDirectionForward:"forward",sSelectorContent:".nm-content",sSelectorContentElem:".nm-wrapper-content .nm-area-content",sSelectorNavigation:"#nm-navigation li, .sc-main-navigation-list li",sSelectorPageTitle:"#nm-page-title"},Z.addClassToSelector=function(t,n){e.dom.getElement(t).classList.add(n)},Z.removeClassFromSelector=function(t,n){e.dom.getElement(t).classList.remove(n)},Z.extractNavigationURLs=function(t){let n;return Z.navURLs=[],t.forEach((function(t){n=e.dom.getElement("a",t).getAttribute("data-href"),n&&Z.navURLs.push(n)})),Z.navURLs},K.isBackwardsAnimation=function(t,n){let o=n,a=t;return o=void 0!==o?o.replace(SETUPS.get("nemo.core.router.pathBase"),""):window.location.pathname.replace(SETUPS.get("nemo.core.router.pathBase"),""),a=a.replace(SETUPS.get("nemo.core.router.pathBase"),""),null===Z.navURLs&&K.extractNavUrls(e.dom.getElement(Z.oDefaults.sSelectorContentElem)),Z.navURLs.indexOf(a)<Z.navURLs.indexOf(o)},K.isNomo=function(){const e=document.querySelector(Z.oDefaults.sSelectorContent);return!!e&&"nomo"===e.getAttribute("data-type")},K.extractNavUrls=function(t){return Z.extractNavigationURLs(e.dom.getElementsArray(Z.oDefaults.sSelectorNavigation,t))},K.getCurrentPageId=function(){return e.dom.getElement(Z.oDefaults.sSelectorContent).getAttribute("data-guid")},K.setPageTitle=function(e){document.title=e},K.extractPageTitle=function(t){const n=e.dom.getElement(Z.oDefaults.sSelectorPageTitle,t);let o="";return e.dom.isElement(n)&&(o=n.innerHTML),o},K.insertNewPageContent=function(t){const n=e.dom.getElement(Z.oDefaults.nmContentWrapper);e.dom.appendHtmlString(n,t),Z.processScripts(t);return e.dom.getElement(Z.oDefaults.sSelectorContentElem+":last-child")},Z.processScripts=function(e){const t=document.createElement("div");t.innerHTML=e;const n=t.querySelectorAll("script"),o=[...document.head.querySelectorAll("script")].map((e=>e.getAttribute("src")));n.forEach((e=>{const t=e.getAttribute("src");if(null===e.getAttribute("noModule")&&![...o].includes(t)){const e=document.createElement("script");e.setAttribute("src",t),document.head.appendChild(e)}}))},K.preparePageTransition=function(e){const t=e?Z.oDefaults.sClassDirectionBackward:Z.oDefaults.sClassDirectionForward;Z.addClassToSelector(Z.oDefaults.nmContentWrapper,t)},K.triggerPageTranstion=function(){Z.addClassToSelector(Z.oDefaults.nmContentWrapper,Z.oDefaults.sClassAnimate)},K.finishPageTransition=function(){const t=e.dom.getElement("body");Z.removeClassFromSelector(Z.oDefaults.nmContentWrapper,Z.oDefaults.sClassAnimate),Z.removeClassFromSelector(Z.oDefaults.nmContentWrapper,Z.oDefaults.sClassDirectionBackward),Z.removeClassFromSelector(Z.oDefaults.nmContentWrapper,Z.oDefaults.sClassDirectionForward),e.dom.removeElement(e.dom.getElement(Z.oDefaults.sSelectorContentElem+":first-child")),t.classList.remove("nm-nav-fixed"),t.classList.remove("nm-page-nav-is-open"),window.pageYOffset>0&&e.dom.scrollTo(0,400)};const Q={},$={__:Q};Q.eventBus=null,Q.currentPageId=null,Q.queue=[],Q.lock=!1,Q.backwardsAnimation=!1,Q.oDefaults={navSelector:""},Q.triggerPageTransitionTimeout=null,Q.finishPageTransitionTimeout=null,Q.initialize=function(){Q.oDefaults.navSelector=SETUPS.get("nemo.nav.navSelector"),Q.currentPageId=K.getCurrentPageId(),Q.addEvents()},Q.addEvents=function(){Q.eventBus.on(t.PAGE_OPEN,Q.handlePageOpen),Q.oDefaults.navSelector?k.register(Q.oDefaults.navSelector+" a","page"):console.warn("nemo.nav.navSelector is undefined"),k.register(".nm-pageOpen","page")},Q.handlePageTransitionComplete=function(){Q.reset(),Q.queue.length>0?(Q.handlePageOpen(Q.queue.pop()),Q.queue=[]):(Q.eventBus.emit(t.PAGE_READY),Q.dispatchCustomEvent("PAGE_READY"))},Q.dispatchCustomEvent=function(e,t){try{let n;n=t?new CustomEvent(e,{detail:t}):new CustomEvent(e),document.dispatchEvent(n)}catch(t){console.error("dispatchCustomEvent: ","the custom-event for "+e+" could not be dispatched",t)}},Q.handlePageOpen=function(e){if(this&&"function"==typeof this.preventDefault&&this.preventDefault(),Q.isLocked())Q.queue.push(e);else{let t=e.pathname;Q.setLock((new Date).getTime()),"/"!==t.substr(0,1)&&(t="/"+t),Q.newPageUrl=t,j.getContent(t,!1).then(Q.pageContentHandler).catch(Q.handlePageOpenError)}},Q.isLocked=function(){return!!Q.lock},Q.setLock=function(e){Q.lock=e},Q.reset=function(){Q.lock=!1,Q.currentPageUrl=Q.newPageUrl,Q.newPageUrl="",Q.newPageId=null,Q.newPageTitle=null},Q.pageContentHandler=function(e){const n=K.insertNewPageContent(e);Q.eventBus.emit(t.PAGE_LOADED,{domElement:n}),Q.dispatchCustomEvent("PAGE_LOADED",{element:n,type:"page"}),Q.backwardsAnimation=K.isBackwardsAnimation(Q.newPageUrl,Q.currentPageUrl),K.preparePageTransition(Q.backwardsAnimation),Q.clearPageTransitionTimeouts(),Q.triggerPageTransitionTimeout=setTimeout((function(){K.triggerPageTranstion()}),10),Q.finishPageTransitionTimeout=setTimeout((function(){K.finishPageTransition(),Q.handlePageTransitionComplete()}),1e3)},Q.handlePageOpenError=function(n){let o;history.back(),o=e.template.render(Y,{errorMessage:window.i18n["error-layer.unknown-error"]||"Es ist ein unbekannter Fehler aufgetreten"}),console.error(n),P.open("error",o).then((function(e){e.getElement().querySelector(".nm-error-layer .nm-j-ok-btn").addEventListener("click",(function t(n){n.preventDefault&&n.preventDefault(),n.target.removeEventListener(n.type,t),e.close()}))})),Q.eventBus.emit(t.PAGE_READY),Q.reset()},$.initialize=function(e){Q.eventBus=e,Q.initialize()},Q.clearPageTransitionTimeouts=function(){Q.triggerPageTransitionTimeout&&clearTimeout(Q.triggerPageTransitionTimeout),Q.finishPageTransitionTimeout&&clearTimeout(Q.finishPageTransitionTimeout)};const ee={},te={__:ee};ee.oDefaults={initalScWrapper:".nm-wrapper .sc-content",initialContentAreaSelector:".nm-wrapper-content .nm-area-content:first-child"},ee.addEvents=function(){ee.eventBus.one(t.SC_VERSION_LOADED,ee.handlerSvdVersionLoaded),ee.eventBus.on(t.PAGE_LOADED,ee.handlerPageLoaded),ee.eventBus.one(t.VERSION_LOAD_COMPLETE,ee.handlerVersionLoaded)},ee.preloadContent=function(e){let t;"true"!==SETUPS.get("nemo.content.preload")&&"true"!==SETUPS.get("stockcar.context")&&!1!==K.isNomo()||(t=K.extractNavUrls(e),j.fillCache(t))},ee.handlerPageLoaded=function(e){ee.preloadContent(e.domElement)},ee.handlerVersionLoaded=function(){ee.preloadContent(e.dom.getElement(ee.oDefaults.initialContentAreaSelector))},ee.handlerSvdVersionLoaded=function(){ee.preloadContent(e.dom.getElement(ee.oDefaults.initalScWrapper))},te.initialize=function(e){ee.eventBus=e,ee.addEvents()};const ne={},oe={__:ne};ne.addEvents=function(){ne.eventBus.on(t.PAGE_LOADED,ne.handlerPageLoaded)},ne.handlerPageLoaded=function(e){const t=e.domElement,n=K.extractPageTitle(t);let o,a;n&&""!==n&&(o=document.createElement("div"),o.innerHTML=n,a=o.firstChild.nodeValue,K.setPageTitle(a))},oe.initialize=function(e){ne.eventBus=e,ne.addEvents()};const ae={},re={__:ae};ae.oDefaults={selectorAreaContent:".nm-area-content",selectorBody:"body"},ae.eventBus=null,ae.addEvents=function(){ae.eventBus.on(t.PAGE_READY,ae.updatePageType)},ae.removeEvents=function(){ae.eventBus.off(t.PAGE_READY,ae.updatePageType)},ae.updatePageType=function(){const t=e.dom.getElement(ae.oDefaults.selectorAreaContent),n=e.dom.getElement(ae.oDefaults.selectorBody),o=t.getAttribute("data-page-type")||!t.length&&n.getAttribute("page-type")||"default";n.setAttribute("page-type",o)},re.initialize=function(e){ae.eventBus=e,ae.addEvents()};const se={},ie={__:se};let le,ce=!1,de=!1,ue={bottom:0,top:0},he=[],me=[[],[]],pe=[0,0],Ee={ABOVE:1,BELOW:3,IN:2},ge={AFTERSCROLL:1,ONSCROLL:0},ye={COVER:1,INOUT:0,SCROLLDOWN:3,SCROLLUP:2},fe={eventName:"",mode:ye.INOUT,notifyWhen:ge.ONSCROLL};se.updateViewportData=function(){ue={bottom:window.innerHeight||document.documentElement.clientHeight,top:0}},se.pageLoadHandler=function(e){let t,n;for(me=[[],[]],se.eventBus.removeAllListeners("element.scroll"),t=0,n=he.length;t<n;t++)se.register(he[t].selector,he[t].options,he[t].callback,e.domElement,!0)},se.initializeListeners=function(){ce||(window.addEventListener("scroll",se.scrollHandler),window.addEventListener("scroll",se.scrollEndHandler),window.addEventListener("resize",se.scrollHandler),window.addEventListener("resize",se.scrollEndHandler),window.addEventListener("resize",se.updateViewportData),se.updateViewportData(),ce=!0)},se.register=function(e,t,n,o){let a,r,s,i,l,c,d,u,h,m,p;if(void 0!==o&&o||he.push({callback:n,options:t,selector:e}),r=document,a=r.querySelectorAll(e),a.length){for(se.initializeListeners(),s=t.notifyWhen||fe.notifyWhen,i=t.eventName||fe.eventName,l=t.mode||fe.mode,c=[],se.eventBus.addListener("element.scroll."+i,n),d=0,p=a.length;d<p;d++)u=a[d],h=se.getElementsState(u,l,a),m={element:u,elements:a,eventName:i,mode:l,selector:e,was:h,where:h},se.eventBus.trigger("element.scroll."+m.eventName,m),c.push(m);me[s].push(c)}},se.getElementsState=function(e,t,n){const o=se.getElementState(e);let a;if(t===ye.COVER&&o===Ee.IN)for(a=0;a<n.length&&n[a]!==e;a++)if(100===se.getElementCoverage(n[a]))return Ee.BELOW;return o},se.getElementState=function(e){const t=e.getBoundingClientRect();return t.top>=ue.top&&t.top<ue.bottom||t.bottom>=ue.top&&t.bottom<ue.bottom||t.top<ue.top&&t.bottom>ue.top?Ee.IN:t.top<ue.top?Ee.ABOVE:Ee.BELOW},se.getElementCoverage=function(e){let t,n,o;return se.getElementState(e)!==Ee.IN?0:(o=e.getBoundingClientRect(),o.top>=ue.top&&o.bottom<=ue.bottom?100:(t=o.top,n=o.bottom,t<0&&(t=0),n>ue.bottom&&(n=ue.bottom),(n-t)/(ue.bottom-ue.top)*100))},se.dump=function(){console.info(me)},se.checkOnScroll=function(){se.checkChangedElements(ge.ONSCROLL)},se.checkAfterScroll=function(){se.checkChangedElements(ge.AFTERSCROLL)},se.checkChangedElements=function(e){let t,n,o,a=window.scrollY;if(de=!1,me[e].length>0)for(t=0,o=me[e].length;t<o;t++)for(n in me[e][t])me[e][t][n]&&document.body.contains(me[e][t][n].element)&&(me[e][t][n]=se.checkChangedElement(me[e][t][n],e,a));pe[e]=a},se.checkChangedElement=function(e,t,n){const o=se.getElementsState(e.element,e.mode,e.elements);return e.was=e.where,e.where=o,e.mode===ye.SCROLLDOWN?n>pe[t]&&se.eventBus.trigger("element.scroll."+e.eventName,e):e.mode===ye.SCROLLUP?n<pe[t]&&se.eventBus.trigger("element.scroll."+e.eventName,e):e.was!==e.where&&se.eventBus.trigger("element.scroll."+e.eventName,e),e},se.scrollHandler=function(){de||(de=!0,window.requestAnimationFrame(se.checkOnScroll))},se.scrollEndHandler=function(){clearTimeout(le),le=window.setTimeout((function(){window.requestAnimationFrame(se.checkAfterScroll)}),250)},ie.initialize=function(e){se.eventBus=e,se.eventBus.on(t.PAGE_LOADED,se.pageLoadHandler)},ie.register=se.register,ie.unregister=se.unregister,ie.WHERE=Ee,ie.NOTIFY=ge,ie.MODE=ye;const Le={},_e={__:Le};Le.addEvents=function(){Le.eventBus.on(t.LAYER_LOADED,Le.handerLayerLoaded),Le.eventBus.on(t.LAYER_CLOSED,Le.handerLayerClosed)},Le.handerLayerClosed=function(){const t=e.dom.getElement(".nm-layer-toolbar.nm-suppress-space-toolbar");t&&null!==t&&t.classList.remove("nm-suppress-space-toolbar")},Le.handerLayerLoaded=function(e){if(e&&e.element){const t=e.element.querySelector(".nm-suppress-space-toolbar");if(t&&null!==t){const e=document.querySelector(".nm-layer-toolbar");e&&e.classList.add("nm-suppress-space-toolbar")}}},_e.initialize=function(e){Le.eventBus=e,Le.addEvents()},window.i18n=window.i18n||{};const Se=[P,x,G,X,$,te,oe,re,k,ie,_e],Ce=_.getEmitter();Se.forEach((e=>{try{e.initialize(Ce)}catch(e){console.error(e)}}))})(),s})()));
//# sourceMappingURL=audi-core-application.js.map