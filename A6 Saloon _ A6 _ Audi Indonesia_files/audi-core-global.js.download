/*! @oneaudi/audi-core-global 8.0.2 - Mon, 14 Aug 2023 10:58:38 GMT
License information can be found in audi-core-global.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("core-application"),require("core-utils"),require("microkernel")):"function"==typeof define&&define.amd?define("core-global",["core-application","core-utils","microkernel"],t):"object"==typeof exports?exports["core-global"]=t(require("core-application"),require("core-utils"),require("microkernel")):e["core-global"]=t(e["core-application"],e["core-utils"],e.microkernel)}(self,((e,t,n)=>(()=>{"use strict";var o={799:t=>{t.exports=e},39:e=>{e.exports=t},214:e=>{e.exports=n}},a={};function r(e){var t=a[e];if(void 0!==t)return t.exports;var n=a[e]={exports:{}};return o[e](n,n.exports,r),n.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{r.r(i),r.d(i,{bounceLink:()=>a,cookiePolicy:()=>d,cookiePolicyTemplate:()=>l,crsApi:()=>m,entryScroll:()=>D,error:()=>k,errorLogging:()=>L,hideHeaderFooter:()=>b,interceptDebugMode:()=>H,interstitialLayer:()=>R,iph:()=>B,iphCartTemplate:()=>M,menuFlyOut:()=>q,modelNavigationWrap:()=>$,patternMatching:()=>n,poa:()=>Q,scroll:()=>y,scrollStickyElements:()=>te,state:()=>A,usabilla:()=>oe});var e=r(799);const t={},n={__:t};t.oDefaults={},t.registered={},t.extractUrlParams=function(e){let t=[];return e&&e.indexOf("{{")>0&&(t=e.match(/{{\s*(=)?[(\w|_)\.|:]+\s*}}/g).map((function(e){return e.match(/(=)?[\w\.|:]+/)[0]}))),t},n.getReplacedUrl=function(e,n){let o,a=[];return o=t.extractUrlParams(e),o.forEach((function(e){a.push(t.replaceUrl(e))})),Promise.all(a).then((function(n){return t.buildPatchedUrl(n,e)})).catch((function(e){return console.warn(e),Promise.resolve(n)}))},t.buildPatchedUrl=function(e,t){let n,o,a=t;return e.forEach((function(e){o=Object.keys(e),n=encodeURIComponent(e[o]),a=a.replace("{{"+o[0]+"}}",n)})),Promise.resolve(a)},t.replaceUrl=function(e){let n,o,a,r=e.replace(":mandatory","");return new Promise((function(i,l){n=t.registered[r],a={},o=!!e.match(/:mandatory/),n&&"function"==typeof n?(console.info("pattern-matching.js --\x3e replaceUrl() --\x3e mandatory: ",e),n(r).then((function(t){!t&&o?l():(a[e]=t,i(a))})).catch((function(t){o?l(t):(a[e]="",i(a))}))):(console.warn("no matching module found for pattern: "+e),o?l():(a[e]="",i(a)))}))},n.register=function(e,n){t.registered[e]?console.warn("pattern ist already registered: ",e):t.registered[e]=n};class o{static get BOUNCE_CLASS(){return".audi-js-bounce-link"}initialize(t){const n=this._processURL.bind(this);t.on(e.appEvents.CONFIG_UPDATE,n),t.on(e.appEvents.LAYER_LOADED,n),t.on(e.appEvents.CONFIG_START,n),t.on(e.appEvents.PAGE_LOADED,n)}async _processURL(){return Promise.all([...document.querySelectorAll(o.BOUNCE_CLASS)].map((async e=>{const t=e.getAttribute("href"),o=e.getAttribute("data-link-pattern");if(t&&o){const a=await n.getReplacedUrl(o,t);e.setAttribute("href",a)}})))}}const a=new o,l='\n\t<div class="nm-cookiepolicy" data-theme="dark" data-module="cookie-policy">\n\t\t<div class="nm-cookiepolicy-inner nm-text-list">\n\t\t\t<div>{{=it.text}}</div>\n\t\t\t<ul>\n\t\t\t\t<li>\n\t\t\t\t\t<a x-cq-linkchecker="skip" id="showPolicy" href="{{=it.linkUrl}}" class="nm-layerLink nm-link-basic">{{=it.linkText}}</a>\n\t\t\t\t</li>\n\t\t\t\t<li>\n\t\t\t\t\t<a x-cq-linkchecker="skip" style="text-decoration: none" id="continue" class="continue nm-link-basic">\n\t\t\t\t\t\t<span>{{=window.i18n[\'cookie-continue-label\']}}</span>\n\t\t\t\t\t\t<svg class="nm-icon-arrow">\n\t\t\t\t\t\t\t<use xlink:href={{=SETUPS.get(\'coreci.url.assets\')+"/icons/svg/arrow.svg#nm-icon-arrow"}}></use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</a>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t</div>\n';var s=r(39);const c={},d={__:c};c.checkCookiePolicy=function(){const e=s.dom.getElement(".nm-header");let t;s.dom.isElement(e)&&(!SETUPS.get("cookie.policy.scope")||localStorage.getItem("cookiepolicy")||c.localCookiePolicy||(t={linkText:SETUPS.get("cookie.link.text"),linkUrl:SETUPS.get("cookie.link.url"),text:SETUPS.get("cookie.text")},e.insertAdjacentHTML("beforebegin",s.template.render(l,t))))},c.handleCookieAccepted=function(){const e=s.dom.getElement(".nm-cookiepolicy");try{localStorage.setItem("cookiepolicy",!0)}catch(e){c.localCookiePolicy=!0}s.dom.isElement(e)&&e.classList.add("nm-hidden")},c.addEvents=function(){c.domEventDelegate.on("click",".continue",c.handleCookieAccepted)},c.initialize=function(){c.init||c.addEvents(),c.init=!0,c.checkCookiePolicy()},d.initialize=function(){c.domEventDelegate=s.dom.getEventDelegate("body"),c.initialize()},d.initialize();const u={},m={__:u},g="CalculateRate",v="Defaults",p="Products",f="Some Error occured during the Request:";u.crsRequest=async function(e,t){try{const n=await fetch(e,{body:JSON.stringify(t),headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST"}),o=await n.json();return u.isErrorResponse(o)?(console.warn("crs-api: "+o.Response.Error.Description),`${f} ${o.Response.Error.Description}`):o}catch(e){throw new Error(`${f} ${e}`)}},u.prepareRequestData=function(e,t,n,o,a){let r={Request:{}};return e&&t&&o&&(r.Request["@Name"]=e,r.Request["@Domain"]=t,r.Request.Vehicle=o,a&&"object"==typeof a&&Object.keys(a).length>0&&(r.Request.Dealer=a),n&&"object"==typeof n&&Object.keys(n).length>0&&(r.Request.Product=n)),r},u.prepareProductsResponse=function(e){return e&&e.Response&&e.Response.Products&&e.Response.Products.Product?e.Response.Products:{}},u.prepareProductDataResponse=function(e){let t={};return e&&e.Response&&e.Response.Parameters&&(t.Parameters=e.Response.Parameters,e.Response.Error&&(t.Error=e.Response.Error)),t},u.prepareProductRequestData=function(e,t){let n=e||{};return e&&t&&t.Parameter&&(n.Parameter=t.Parameter),n},u.isErrorResponse=function(e){return!(e&&e.Response&&(!e.Response.Error||"User"===e.Response.Error["@ErrorType"]))},m.getProducts=function(e,t,n){const o=u.prepareRequestData(p,t,{},n);return u.crsRequest(e,o).then((function(e){return u.prepareProductsResponse(e)}))},m.getDefaultDataForProduct=function(e,t,n,o,a){const r=u.prepareRequestData(v,t,n,o,a);return u.crsRequest(e,r).then((function(e){return u.prepareProductDataResponse(e)}))},m.getDefaultRawDataForProduct=function(e,t,n,o,a){const r=u.prepareRequestData(v,t,n,o,a);return u.crsRequest(e,r).then((function(e){return e}))},m.getDataForProduct=function(e,t,n,o,a,r){const i=u.prepareProductRequestData(n,o);return m.getDefaultDataForProduct(e,t,i,a,r)},m.getCalculateRateData=function(e,t,n,o,a,r){let i=u.prepareProductRequestData(n,o),l=u.prepareRequestData(g,t,i,a,r);return u.crsRequest(e,l)};const h={},y={__:h};h.oDefaults={layerSubstr:".nm-layer-opened .nm-layer ",layerWrapperSelector:".nm-layer-wrapper",scrollDataAttributeName:"data-scroll"},h.handler=function(e){e.preventDefault();const t=s.dom.closest(e.target,"["+h.oDefaults.scrollDataAttributeName+"]"),n=h.getScrollAnchorClassSelector(t.getAttribute(h.oDefaults.scrollDataAttributeName)),o=document.querySelector(".nm-nav-fixed .nm-nav-wrap"),a=o?o.clientHeight:0;h.detectScrollElementAndScroll(n,a)},h.detectScrollElementAndScroll=function(e,t){let n,o,a,r=t||0;e&&s.dom.isElement(e)&&(s.dom.selectorIsInLayerContext(e)?(n=s.dom.getElementsArray(h.oDefaults.layerSubstr+e),o=s.dom.getElement(h.oDefaults.layerWrapperSelector)):(n=s.dom.getElementsArray(e),o=s.dom.getElement("body")),n=n.filter((function(e){return!s.dom.isHidden(e)})),a=h.getElementsScrollPosition(n),h.scrollContent(o,a-r))},y.scrollToElementWithDistance=function(e,t){h.detectScrollElementAndScroll(e,t)},h.getScrollAnchorClassSelector=function(e){let t=e;return t="string"!=typeof t||t.length<2?null:"."+t,t},h.scrollContent=function(e,t){s.dom.isElement(e)&&!isNaN(t)&&(e===document.body?s.dom.scrollTo(t,400):s.dom.animateElementY(t,e,400))},h.getElementsScrollPosition=function(e,t){let n=0,o=parseInt(window.scrollY||window.pageYOffset,10);return e&&e[0]&&(n=parseInt(e[0].getBoundingClientRect().top+o,10),e.length>1&&"nm-top"===t&&(n=0)),n},h.addEvents=function(){s.dom.getEventDelegate("body").on("click",".nm-j-scroll",h.handler)},y.initialize=function(){h.addEvents()},y.initialize();const E={},D={__:E};E.registeredModules={},E.GAP=70,E.MAX_INTERVAL_COUNT=10,E.BETWEEN_INTERVAL=200,D.register=function(e,t){E.registeredModules[e]=t},E.handlePageLoaded=function(){const e=E.getScrollParamFromHash();let t;for(t in E.registeredModules)E.registeredModules.hasOwnProperty(t)&&e===t&&E.startInterval(t)},E.startInterval=function(e){let t,n,o=0,a='[data-module="'+E.registeredModules[e]+'"]';t=setInterval((function(){n=s.dom.getElement(a),s.dom.isElement(n)&&!s.dom.isHidden(n)&&(clearInterval(t),y.scrollToElementWithDistance(a,E.GAP)),o===E.MAX_INTERVAL_COUNT&&clearInterval(t),o++}),E.BETWEEN_INTERVAL)},E.getScrollParamFromHash=function(){let e,t=location.hash;return t=t.match(/scroll=[a-zA-Z0-9]*/),t&&(e=t[0].split("=")[1]||null),e||null},E.addEvents=function(){E.eventBus.on(e.appEvents.LAYER_CLOSED,E.handlePageLoaded)},D.initialize=function(e){E.eventBus=e,E.addEvents()};const S={},k={__:S};S.oDefaults={layerSelectorClose:".nm-error-layer .nm-button-close",layerSelectorOK:".nm-error-layer .nm-j-ok-btn"},S.onError=function(e){k.handleError(S.getErrorTexts(e))},S.getErrorTexts=function(e){const t={errorHeadline:null,errorMessage:null};return Array.isArray(e)?(t.errorHeadline=e[0],t.errorMessage=2===e.length&&e[1]?e[1]:null,t):"string"==typeof e?(t.errorMessage=e,t):e&&(e.message||e.headline)?(t.errorMessage=e.message,t.errorHeadline=e.headline,t):t},S.addEvents=function(){S.domEventDelegate.on("click",S.oDefaults.layerSelectorClose,S.closeLayer),S.domEventDelegate.on("click",S.oDefaults.layerSelectorOK,S.closeLayer)},S.removeEvents=function(){S.domEventDelegate.off("click",S.oDefaults.layerSelectorClose,S.closeLayer),S.domEventDelegate.off("click",S.oDefaults.layerSelectorOK,S.closeLayer)},S.openLayer=function(t,n,o){return new Promise((function(a,r){e.layerApi.open(t,n,o).then((function(e){S.layerInstance=e,S.addEvents(),a(S.layerInstance)})).catch((function(e){r(e)}))}))},S.closeLayer=function(e){let t,n;return n=S.getRedirectURL(),null!==n&&(window.location.href=n),S.cancelEvent(e),t=S.layerInstance.close(),t.then((function(){S.layerInstance=null,S.onLayerClose()}),(function(e){throw new TypeError("Error closing error Layer: "+e.message)}))},S.getRedirectURL=function(){const e=s.dom.getElement("body");return s.dom.getDataAttribute(e,"redirect-url")},S.cancelEvent=function(e){e&&"function"==typeof e.preventDefault&&e.preventDefault()},S.onLayerClose=function(){S.removeEvents()},k.handleError=function(t){let n,o,a,r,i;return new Promise((function(l,c){n="error-layer",i=t,i.errorHeadline=i.errorHeadline?i.errorHeadline:window.i18n["error-layer.headline"],o=s.dom.renderTemplate(e.layerErrorTemplate,i),S.renderedElement=s.dom.createElementsFromHtmlString(o)[0],i.errorMessage||(a=s.dom.getElement(".nm-error-layer-message",S.renderedElement),i.errorMessage=a.getAttribute("data-defaultErrorMessage"),a.innerText=i.errorMessage),r=S.renderedElement.outerHTML,S.openLayer("error-layer",r,S.closeLayer).then(l,c)}))},k.initialize=function(t){S.eventBus=t,S.domEventDelegate=s.dom.getEventDelegate("body"),S.eventBus.on(e.appEvents.ERROR,S.onError)};const w={},L={__:w};w.oDefaults={disableTrackJSLinkSelector:".j-trackjs-optout"},w.addEvents=function(){const e=w.getStorage();e&&"false"===e.getItem("trackJsLogging")&&w.disableTrackJSLogging(!0),w.domDelegate.on("click",w.oDefaults.disableTrackJSLinkSelector,w.disableTrackJSLogging),window.addEventListener("unhandledrejection",w.handleUnhandledRejectionErrors)},w.handleUnhandledRejectionErrors=function(e){console.warn(e.reason),window._trackJs&&window._trackJs.track&&window._trackJs.track(e.reason)},w.getStorage=function(){return window.localStorage},w.disableTrackJSLogging=function(e){let t=w.getStorage(),n=t.getItem("trackJsLogging")||"true",o=window.i18n["nemo.ui.optout.message"],a=window.i18n["nemo.ui.optout.headline"];!0!==e&&(n="true"===n?"false":"true","true"===n&&(o=window.i18n["nemo.ui.optin.message"],a=window.i18n["nemo.ui.optin.headline"]),k.handleError({errorHeadline:a,errorMessage:o,errorSubheadline:""})),window._trackJs&&window._trackJs.onError&&(window._trackJs.onError=function(){return"false"!==n}),t&&t.setItem("trackJsLogging",n)},L.initialize=function(){w.domDelegate=s.dom.getEventDelegate("body"),w.addEvents()},L.initialize();let I={},b={__:I};I.oDefaults={selectorFooter:".nm-footer",selectorFootnote:".nm-footnote-wrap",selectorHeader:".nm-header"},I.initialize=function(){I.isHideHeaderFooter()?(I.persistHideHeaderFooter(),I.removeHeaderFooter()):I.isHideHeaderFooterPersistent()&&I.removeHeaderFooter()},I.persistHideHeaderFooter=function(){let e=I.getSessionStorage();e&&e.setItem("hideHeaderFooter",!0)},I.isHideHeaderFooter=function(){return window.location.hash&&window.location.hash.indexOf("hideHeaderFooter")>-1},I.isHideHeaderFooterPersistent=function(){let e=I.getSessionStorage(),t=!1;return e&&(t=e.getItem("hideHeaderFooter")),t},I.getSessionStorage=function(){return window.sessionStorage||null},I.removeHeaderFooter=function(){let e=s.dom.getElement(I.oDefaults.selectorHeader),t=s.dom.getElement(I.oDefaults.selectorFooter),n=s.dom.getElement(I.oDefaults.selectorFootnote);e.style.display="none",t.style.display="none",n.style.paddingTop="40px"},b.isHiddenHeaderFooter=function(){return I.isHideHeaderFooter()||I.isHideHeaderFooterPersistent()},b.initialize=function(){I.initialize()};const C={},A={__:C},P={1920:!1,debug:!1,module:!1};A.getStateOfModeFor=function(e){return P[e]||!1},A.triggerModeChange=function(e,t){let n;return n="true"===t||!0===t,void 0!==P[e]&&(!0===n?C.activateState(e):C.deactivateState(e),!0)},C.activateState=function(e){const t=C.getDomBodyElement(),n=C.getDomHtmlElement();"1920"===e&&(t.setAttribute("page-type","widescreen"),t.setAttribute("page-override","widescreen-overwrite")),P[e]=!0,n.classList.add("nm-state-is-"+e)},C.deactivateState=function(e){const t=C.getDomBodyElement(),n=C.getDomHtmlElement();"1920"===e&&(t.removeAttribute("page-type","widescreen"),t.removeAttribute("page-override","widescreen-overwrite")),P[e]=!1,n.classList.remove("nm-state-is-"+e)},C.getDomBodyElement=function(){return document.querySelector("body")},C.getDomHtmlElement=function(){return document.querySelector("html")};class N{constructor(){if(N._instance)return N._instance;N._setState(),N._instance=this}static _setState(){N._urlContainsDebugMode()?A.triggerModeChange("debug","true"):A.triggerModeChange("debug","false")}static _urlContainsDebugMode(){return-1!==window.location.href.indexOf("debug=true")}}const H=new N;const R=new class{initialize(){const t=SETUPS.get("nemo.InterstitialLayerLink"),n=this._getCurrentCarline();this._writeLayerHasBeenShown=this._writeLayerHasBeenShown.bind(this),t&&n&&(this.storageKey=this._getStorageKeyForCarline(n),document.addEventListener(e.appEvents.INTERSTITIAL_LAYER_CLOSE,this._writeLayerHasBeenShown),this._processInterstitialLayer(t))}_getCurrentCarline(){let e=document.querySelector("meta[name=carline]");return e?e.getAttribute("content"):""}_processInterstitialLayer(e){this._readLayerHasBeenShown()||this._openInterstitialLayer(e)}_getStorageKeyForCarline(e){return"audi-interstitial-layer-"+e}_readLayerHasBeenShown(){return this.sessionStorageAlternative?this.sessionStorageAlternative[this.storageKey]:sessionStorage.getItem(this.storageKey)}_openInterstitialLayer(e){const t={clickOnShaderClosesModal:!1,dataset:{linkUrl:e},isLayerClosable:!1,layerType:"ModalLayerInterstitialElement"};document.dispatchEvent(new CustomEvent("MODAL_LAYER_OPEN",{detail:t}))}_writeLayerHasBeenShown(){try{sessionStorage.setItem(this.storageKey,!0)}catch(e){this.sessionStorageAlternative=this.sessionStorageAlternative?this.sessionStorageAlternative:{},this.sessionStorageAlternative[this.storageKey]=!0}}};var O=r(214);const x=function(e,t){return Object.assign({},e,t)},_=function(){return{}};class T{static get NAME(){return"dbadDealerStore"}static get ACTIONS(){return{RESET_DEALER:"resetDealer",SET_DEALER:"setDealer"}}static activeStoreExistsInLocalStorage(){const e=window.localStorage.getItem("dbadDealerStore");if(e&&""!==e){const t=JSON.parse(e);if(t&&t.timestamp){return Date.now()-t.timestamp<864e5}}return!1}static addIphStore(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};O.stateRegistry.addStore(T.NAME,e,{resetDealer:_,setDealer:x},{storageType:O.StorageTypes.LOCAL_STORAGE})}}const M='\n\t<li class="nm-iph-item">\n\t\t<a href="{{=it.dealerURL}}" target="_blank" class="nm-iph-item nm-iph-name nm-el-pg nm-el-pg-04 nm-at-pg-b" title="{{=it.dealerName}}">{{=it.dealerName}}</a>\n\t\t<a x-cq-linkchecker="skip" href="#" class="nm-icon-cancel"></a>\n\t</li>\n\t<li class="nm-iph-item">\n\t\t<span class="nm-iph-phone nm-el-pg nm-el-pg-04">{{=it.dealerPhoneLabel}} {{=it.dealerPhone}}</span>\n\t</li>\n',F={},B={__:F};F.oDefaults={sClassIPHActive:"nm-iph-active",sSelectorIPHCancelBtn:".nm-iph-item .nm-icon-cancel",sSelectorIPHWrapper:".nm-iph-wrapper"},B.parsePartnerID=function(){let e=!1;return window.location.search&&window.location.search.indexOf("partner_id=")>-1?e=window.location.search.split("partner_id=")[1]:window.location.hash&&window.location.hash.indexOf("partner_id=")>-1&&(e=window.location.hash.split("partner_id=")[1]),e&&(e=e.split("&")[0]),e},B.addPartnerId=function(e){let t=e;return-1===t.indexOf("partner=")&&(t.indexOf("?")>-1?t+="&partner="+F.dealerData.kvpsid:t+="?partner="+F.dealerData.kvpsid),t},B.updateNWB=function(e){return-1===e.search(/(a)+[a-z]*(nwbp)+/g)?e.replace(/(a)+[a-z]*(nwb)+/g,(function(e){return e+"p"})):e},B.inIPHMode=function(){return F.dealerData&&F.dealerData.kvpsid},F.updateDealerLinks=function(){let e,t,n,o;const a=F.renderContext.querySelectorAll(".nm-j-vtp-link");if(a&&a.length>0)for(e=0,t=a.length;e<t;e++)o=a[e],n=o.getAttribute("href"),n=B.addPartnerId(n),o.setAttribute("href",B.updateNWB(n))},F.sendCustomerDataToVeeAPI=function(e,t){const n=[];"undefined"!=typeof vee24&&(n.push(new vee24.crm.Data("BNR",e)),n.push(new vee24.crm.Data("Audipartner",t)),vee24.crm.submit("Customer Information",n))},F.getDealerPhoneLabel=function(){const e="basket.iph.phonelabel";return window.i18n&&window.i18n[e]?window.i18n[e]:"Tel."},F.disableIPHBasket=function(e){O.stateRegistry.triggerAction(T.NAME,T.ACTIONS.RESET_DEALER),e&&this.removeEventListener("click",F.disableIPHBasket)},F.getDealerSearchUrl=function(e){const t=SETUPS.get("iph.clientid")?SETUPS.get("iph.clientid"):"e2aaa0fa0c";return"//"+(SETUPS.get("iph.dealersearchurl")?SETUPS.get("iph.dealersearchurl"):"dealersearch.audi.com/api/json/v2/audi-deu")+"/id?q="+e+"&clientId="+t},F.areDealerDataComplete=function(){return!!F.dealerData&&F.dealerData.kvpsid&&F.dealerData.kvpsSyncId&&F.dealerData.dealerName&&F.dealerData.dealerURL&&F.dealerData.dealerPhone},F.loadPartnerInfo=async function(e){try{const t=F.getDealerSearchUrl(e),n=await fetch(t);return await n.json()}catch(e){throw console.info(`loadPartnerInfo failed ${e.message?e.message:e}`),e}},F.checkForPartnerID=function(){const e=B.parsePartnerID();e?F.loadPartnerInfo(e).then((function(t){t&&t.meta&&"OK"===t.meta.returnCode&&t.partners&&t.partners.length>0?(F.dealerData={dealerName:t.partners[0].name,dealerPhone:t.partners[0].contactDetails.phone.international,dealerURL:t.partners[0].url,kvpsSyncId:t.partners[0].kvpsSyncId,kvpsid:e},T.addIphStore(F.dealerData)):F.addEmptyStoreIfNecessary()})):F.addEmptyStoreIfNecessary()},F.addEmptyStoreIfNecessary=function(){T.activeStoreExistsInLocalStorage()||T.addIphStore({})},F.onIphStoreUpdate=function(e){F.dealerData=e,F.areDealerDataComplete()?F.renderIPH():F.dealerData.kvpsid?F.loadPartnerInfo(F.dealerData.kvpsid).then((function(e){e&&e.meta&&"OK"===e.meta.returnCode&&e.partners&&e.partners.length>0&&(F.dealerData={dealerName:e.partners[0].name,dealerPhone:e.partners[0].contactDetails.phone.international,dealerURL:e.partners[0].url,kvpsSyncId:e.partners[0].kvpsSyncId,kvpsid:F.dealerData.kvpsid}),F.renderIPH()})):F.renderNoIPH()},F.applyIphToContext=function(){F.dealerData&&F.dealerData.kvpsid?F.renderIPH():F.renderNoIPH()},F.renderIPH=function(){const e=F.renderContext.querySelector(F.oDefaults.sSelectorIPHWrapper);if(e){const t={dealerBNR:F.dealerData.kvpsid,dealerName:F.dealerData.dealerName,dealerPhone:F.dealerData.dealerPhone,dealerPhoneLabel:F.getDealerPhoneLabel(),dealerURL:F.dealerData.dealerURL};document.querySelector("body").classList.add(F.oDefaults.sClassIPHActive),e.innerHTML=s.template.render(M,t);const n=F.renderContext.querySelector(F.oDefaults.sSelectorIPHCancelBtn);F.sendCustomerDataToVeeAPI(F.dealerData.kvpsid,F.dealerData.dealerName),n&&n.addEventListener("click",F.disableIPHBasket),!0===SETUPS.get("scope.iph.dealerlink")&&F.updateDealerLinks()}},F.renderNoIPH=function(){document.querySelector("body").classList.remove(F.oDefaults.sClassIPHActive)},F.onPageLoaded=function(e){F.renderContext=e&&e.domElement?e.domElement:document,F.applyIphToContext()},B.initialize=function(t){F.eventBus=t,"1"===SETUPS.get("scope.iph")?(F.renderContext=document,O.stateRegistry.subscribeToStore(T.NAME,F.onIphStoreUpdate),F.eventBus.on(e.appEvents.PAGE_LOADED,F.onPageLoaded),F.checkForPartnerID()):T.addIphStore()};const U={},q={__:U};U.oDefaults={sSelectorHeaderItem:".nm-navigation-header-item",sSelectorOverlayOpen:".nm-header-overlay-is-open",sSelectorFlyoutMenu:".nm-navigation-sitemap-wrap > .nm-navigation-sitemap-wrap-link",sSelectorHeaderLink:".nm-navigation-header-link",sSelectorHeaderDirectLink:"nm-navigation-header-direct-link",sSelectorNavigationContainer:".nm-navigation-header-detail-container",sSelectorNavigation:".nm-navigation-header-detail-container > ul",sSelectorNavigationActiveLink:".nm-header-overlay-is-open .nm-navigation-header-detail-container > ul > li.nm-header-detail-link-active",sSelectorNavigationLink:".nm-navigation-header-detail-container > ul > li > a",sClassDetailLinkActive:"nm-header-detail-link-active",sSelectorOverlay:".nm-navigation-header-overlay",sClassOverlayOpen:"nm-header-overlay-is-open",sSelectorOverlayContainer:".nm-header-overlay-container",sSelectorDropdownVisibiltyCheck:"#nm-navigation-dropdown-menu",sSelectorAdditionalLogo:".nm-has-additional-logo",sNumLogoHeightAdjustment:30,sNumMenuBreakpoint:899,sNumMenuBreakpointCarline:999,sNumHoverTimeout:300,sNumTriangleHeight:460,sNumOverlayHeightOffset:85,sNumOverlayHeightDetailOffset:120},q.open=function(t){let n,o,a,r,i=s.dom.getElement("a",t);U.addBackGroundEventOnce(),t.setAttribute("flyout-is-open","true"),s.dom.isElement(i)&&(n=i.getAttribute("data-ref-id")),o=U.oDefaults.sSelectorOverlayContainer+" "+U.oDefaults.sSelectorOverlay+'[data-ref-id="'+n+'"]',a=s.dom.getElement(o),U.setFlyoutHeight(a),r=s.dom.getElementsArray(".nm-navigation-header-detail .nm-navigation-header-detail-overlay",a),r.forEach((function(e){e.style["transition-delay"]="0s"})),a.classList.add(U.oDefaults.sClassOverlayOpen),U.eventBus.emit(e.appEvents.MENUFLYOUT_OPEN,{item:t}),U.closeDropdownMenu(),t.classList.add(U.oDefaults.sClassOverlayOpen)},q.close=function(t){let n,o,a,r=s.dom.getElement("a",t);s.dom.isElement(r)&&(n=r.getAttribute("href")),o=U.oDefaults.sSelectorOverlayContainer+" "+U.oDefaults.sSelectorOverlay+'[data-ref-url="'+n+'"]',a=s.dom.getElementsArray(o),U.removeBackGroundEvent(),t.setAttribute("flyout-is-open","false"),a.forEach((function(e){e&&void 0!==e.getAttribute("data-height")&&(e.style.height="0"),s.dom.getElementsArray(".nm-navigation-header-detail .nm-navigation-header-detail-overlay-wrap",e).forEach((function(e){e.style["transition-delay"]="1s"})),e.classList.remove(U.oDefaults.sClassOverlayOpen)})),U.eventBus.emit(e.appEvents.MENUFLYOUT_CLOSE,{item:t}),t.classList.remove(U.oDefaults.sClassOverlayOpen)},q.closeAll=function(){s.dom.getElementsArray(U.oDefaults.sSelectorHeaderItem).forEach((function(e){q.close(e)}))},q.isInsideTriangle=function(e,t,n,o,a,r,i,l){const s=(a-n)*(l-o)-(i-n)*(r-o);return((a-e)*(l-t)-(i-e)*(r-t))/s>0&&((i-e)*(o-t)-(n-e)*(l-t))/s>0&&((n-e)*(r-t)-(a-e)*(o-t))/s>0},U.itemIsOpen=function(e){const t=e.getAttribute("flyout-is-open");return!(!t||"true"!==t)},U.handleMenuClick=function(e){const t=this.parentNode;if(this.classList.contains(U.oDefaults.sSelectorHeaderDirectLink))return!0;e.preventDefault(),U.itemIsOpen(t)?q.close(t):(q.closeAll(),q.open(t))},U.handleCloseClick=function(e){const t=s.dom.getElement(U.oDefaults.sSelectorHeaderItem+"."+U.oDefaults.sClassOverlayOpen);e.preventDefault(),q.close(t)},U.handleOverlayClick=function(e){s.dom.isElementOutsideOfElementWithSelector(e.target,U.oDefaults.sSelectorOverlayOpen)&&q.closeAll()},U.handleNavigationMouseEnter=function(e){e.preventDefault(),e.stopImmediatePropagation(),U.activeItem=s.dom.getElement(U.oDefaults.sSelectorNavigationActiveLink),U.domEventDelegate.on("mousemove",U.handleNavigationMouseMove)},U.handleNavigationMouseLeave=function(){U.domEventDelegate.off("mousemove",U.handleNavigationMouseMove)},U.handleActiveItemChange=function(e){U.activeItem.classList.remove(U.oDefaults.sClassDetailLinkActive),U.activeItem=e,U.activeItem.classList.add(U.oDefaults.sClassDetailLinkActive)},U.handleHoverTimeout=function(){s.dom.isElement(U.activeItemNominee)&&U.activeItemNominee.parentNode!==U.activeItem&&U.handleActiveItemChange(U.activeItemNominee.parentNode)},U.handleNavigationMouseMove=function(e){if(U.activeItemNominee=s.dom.closest(e.target,U.oDefaults.sSelectorNavigationLink),!U.activeItemNominee)return;const t=s.dom.closest(e.target,U.oDefaults.sSelectorNavigation),n=s.dom.getElement("a",t.firstElementChild);U.topBoundingRect=n.getBoundingClientRect(),e.clientX<U.topBoundingRect.right&&(U.x0=e.clientX,U.y0=e.clientY,U.x1&&U.y1||(U.x1=U.x0,U.y1=U.y0),U.x2=U.topBoundingRect.right,U.y2=Math.max(0,U.topBoundingRect.top),U.x3=U.x2,U.y3=U.topBoundingRect.top+U.oDefaults.sNumTriangleHeight,U.activeItemNominee.parentNode===U.activeItem?q.isInsideTriangle(U.x0,U.y0,U.x1,U.y1,U.x2,U.y2,U.x3,U.y3)||(U.x1=U.x0,U.y1=U.y0):U.activeItem&&(q.isInsideTriangle(U.x0,U.y0,U.x1,U.y1,U.x2,U.y2,U.x3,U.y3)?(clearTimeout(U.hoverTimeout),U.hoverTimeout=setTimeout(U.handleHoverTimeout,U.oDefaults.sNumHoverTimeout)):U.handleActiveItemChange(U.activeItemNominee.parentNode)))},U.handleFlyoutLinkClick=function(e){let t;window.innerWidth>U.oDefaults.sNumMenuBreakpoint||0===s.dom.getElement(".nm-state-is-responsive").length||s.dom.isElement(e.target)&&e.target.classList.contains("nm-has-sub-nav")&&(e.preventDefault(),e.stopImmediatePropagation(),t=s.dom.closest(e.target,".nm-navigation-sitemap-wrap"),s.dom.isElement(t)&&t.classList.toggle("nm-flyout-is-expanded"))},U.addBackGroundEventOnce=function(){U.domEventDelegate.on("click",U.handleOverlayClick)},U.removeBackGroundEvent=function(){U.domEventDelegate.off("click",U.handleOverlayClick)},U.handleWindowResize=function(){U.setDataHeight(),U.setFlyoutHeight(s.dom.getElement(".nm-navigation-header-overlay.nm-header-overlay-is-open")),U.setDetailFlyoutHeight()},U.addEvents=function(){window.addEventListener("resize",U.handleWindowResize),U.domEventDelegate.on("click",U.oDefaults.sSelectorHeaderItem+" "+U.oDefaults.sSelectorHeaderLink,U.handleMenuClick),U.domEventDelegate.on("click",U.oDefaults.sSelectorOverlay+" .nm-icon-close",U.handleCloseClick),U.domEventDelegate.on("mouseover",U.oDefaults.sSelectorNavigation,U.handleNavigationMouseEnter),U.domEventDelegate.on("mouseout",U.oDefaults.sSelectorNavigation,U.handleNavigationMouseLeave),U.domEventDelegate.on("click",U.oDefaults.sSelectorFlyoutMenu,U.handleFlyoutLinkClick)},U.setDataHeight=function(){s.dom.getElementsArray(".nm-header-overlay-container .nm-navigation-header-overlay").forEach((function(e){const t=s.dom.getElement(U.oDefaults.sSelectorNavigationContainer,e),n=s.dom.getElementsArray(".nm-navigation-header-detail-overlay-content",t);let o=0,a=t.clientHeight+U.oDefaults.sNumOverlayHeightOffset;n.length&&(n.forEach((function(e){o=o<e.clientHeight?e.clientHeight:o})),o+=U.oDefaults.sNumOverlayHeightDetailOffset,a=a<o?o:a),s.dom.isElement(U.oDefaults.sSelectorAdditionalLogo)&&(a+=U.oDefaults.sNumLogoHeightAdjustment),e.setAttribute("data-height",a)}))},U.setDetailFlyoutHeight=function(){let e,t,n,o=s.dom.getElement(".nm-header-overlay-container .nm-navigation-header-overlay.nm-header-overlay-is-open");s.dom.isElement(o)&&(e=s.dom.getElement(U.oDefaults.sSelectorNavigationContainer+" .nm-navigation-header-detail.nm-header-detail-link-active .nm-navigation-header-detail-overlay .nm-navigation-header-detail-overlay-content",o),s.dom.isElement(e)&&(t=e.clientHeight,s.dom.isElement(U.oDefaults.sSelectorAdditionalLogo)&&(t+=U.oDefaults.sNumLogoHeightAdjustment),s.dom.isElement(".nm-navigation-header-detail-container-carline",e)&&window.innerWidth<U.oDefaults.sNumMenuBreakpointCarline?(t=0,e.setAttribute("data-height",t),n=s.dom.getElement(".nm-icon-close"),s.dom.isElement(n)&&n.click()):(e.setAttribute("data-height",t),U.setFlyoutHeight(e))))},U.setFlyoutHeight=function(e){let t=e,n=s.dom.getElement(".nm-navigation-header-overlay.nm-header-overlay-is-open");!s.dom.isElement(t)&&s.dom.isElement(n)&&"0"===n.getAttribute("data-ref-id")&&(t=s.dom.getElement(".nm-navigation-header-overlay.nm-header-overlay-is-open")),s.dom.isElement(t)&&void 0!==t.getAttribute("data-height")&&(t.style.height=t.getAttribute("data-height")+"px")},U.closeDropdownMenu=function(){const e=s.dom.getElement(U.oDefaults.sSelectorDropdownVisibiltyCheck);s.dom.isElement(e)&&e.checked&&(e.checked=!1)},U.initialize=function(){U.addEvents(),U.setDataHeight()},q.initialize=function(e){U.eventBus=e,U.domEventDelegate=s.dom.getEventDelegate("body"),U.initialize()};const z=".nm-navigation-carline-main-item > a",j=".nm-navigation-header-model-overlay",W=".nm-close",J=".nm-navigation-header-wrapped-link",K="nm-navigation-model-container-active",G=".nm-navigation-model-container > ul",Y="nm-header-detail-link-active",V=".nm-navigation-header-dropdown-item a",X={},$={__:X};X.setdetailContentHeight=function(){let e,t,n;n=s.dom.getElement(j),e=s.dom.getElement(".nm-navigation-model-subnavigation",n),t=s.dom.getElement(".nm-navigation-model-container-active .nm-header-detail-link-active .nm-navigation-header-detail-overlay-content",n),n.style.height=e.clientHeight+t.clientHeight+85+"px"},X.handleFlyoutOpen=function(){const e=s.dom.getElement(j);s.dom.isElement(e)&&!e.classList.contains("flyout-is-open")&&(e.classList.add("flyout-is-open"),X.setdetailContentHeight())},X.closeSearchFlyout=function(){const e=s.dom.getElement(".nm-header-overlay-is-open .nm-su-input"),t=s.dom.getElementsArray(".nm-header-overlay-is-open");s.dom.isElement(e)&&e.blur(),t.forEach((function(e){q.close(e)}))},X.checkForFlyoutClose=function(){X.flyoutInterval=setTimeout((function(){const e=s.dom.getElement(j);s.dom.isElement(e)&&e.classList.remove("flyout-is-open")}),100)},X.stopFlyoutClose=function(){clearTimeout(X.flyoutInterval)},X.handleCarlineNavigationHover=function(e){const t=e.target;if(s.dom.isElement(t)){let e=t.getAttribute("data-ref-id");s.dom.getElementsArray(J).forEach((function(e){e.classList.remove("active")})),t.classList.add("active");let n=s.dom.getElementsArray(".nm-navigation-model-container");n.forEach((function(e){e.classList.remove(K)})),n[e-1].classList.add(K),X.setdetailContentHeight()}},X.handleModelNavigationMouseEnter=function(e){e.preventDefault(),e.stopImmediatePropagation(),X.activeItem=s.dom.getElement(".nm-navigation-model-container-active > ul > li.nm-header-detail-link-active"),X.domEventDelegate.on("mousemove",X.handleNavigationMouseMove)},X.handleModelNavigationMouseLeave=function(){X.domEventDelegate.off("mousemove",X.handleNavigationMouseMove)},X.handleActiveItemChange=function(e){X.activeItem.classList.remove(Y),X.activeItem=e,X.activeItem.classList.add(Y),X.setdetailContentHeight()},X.handleHoverTimeout=function(){s.dom.isElement(X.activeItemNominee)&&X.activeItemNominee.parentNode!==X.activeItem&&X.handleActiveItemChange(X.activeItemNominee.parentNode)},X.handleNavigationMouseMove=function(e){if(X.activeItemNominee=s.dom.closest(e.target,".nm-navigation-model-container > ul > li > a"),!X.activeItemNominee)return;let t=s.dom.closest(e.target,G),n=s.dom.getElement("a",t.firstElementChild);X.topBoundingRect=n.getBoundingClientRect(),e.clientX<X.topBoundingRect.right&&(X.x0=e.clientX,X.y0=e.clientY,X.x1&&X.y1||(X.x1=X.x0,X.y1=X.y0),X.x2=X.topBoundingRect.right,X.y2=Math.max(0,X.topBoundingRect.top),X.x3=X.x2,X.y3=X.topBoundingRect.top+460,X.activeItemNominee.parentNode===X.activeItem?q.isInsideTriangle(X.x0,X.y0,X.x1,X.y1,X.x2,X.y2,X.x3,X.y3)||(X.x1=X.x0,X.y1=X.y0):X.activeItem&&(q.isInsideTriangle(X.x0,X.y0,X.x1,X.y1,X.x2,X.y2,X.x3,X.y3)?(clearTimeout(X.hoverTimeout),X.hoverTimeout=setTimeout(X.handleHoverTimeout,300)):X.handleActiveItemChange(X.activeItemNominee.parentNode)))},X.addEvents=function(){X.domEventDelegate.on("mouseover",z,X.handleFlyoutOpen),X.domEventDelegate.on("mouseout",z,X.checkForFlyoutClose),X.domEventDelegate.on("mouseover",j,X.stopFlyoutClose),X.domEventDelegate.on("mouseout",j,X.checkForFlyoutClose),X.domEventDelegate.on("mouseover",J,X.handleCarlineNavigationHover),X.domEventDelegate.on("mouseover",G,X.handleModelNavigationMouseEnter),X.domEventDelegate.on("mouseout",G,X.handleModelNavigationMouseLeave),X.domEventDelegate.on("mouseover",V,X.closeSearchFlyout),X.domEventDelegate.on("click",j+" "+W,X.closeSearchFlyout)},X.removeEvents=function(){X.domEventDelegate.off("mouseover",z,X.handleFlyoutOpen),X.domEventDelegate.off("mouseout",z,X.checkForFlyoutClose),X.domEventDelegate.off("mouseover",j,X.stopFlyoutClose),X.domEventDelegate.off("mouseout",j,X.checkForFlyoutClose),X.domEventDelegate.off("mouseover",J,X.handleCarlineNavigationHover),X.domEventDelegate.off("mouseover",G,X.handleModelNavigationMouseEnter),X.domEventDelegate.off("mouseout",G,X.handleModelNavigationMouseLeave),X.domEventDelegate.off("mouseover",V,X.closeSearchFlyout),X.domEventDelegate.off("click",j+" "+W,X.closeSearchFlyout)},X.initialize=function(){!0===SETUPS.get("hasModelNavigationWrap")&&X.addEvents()},$.initialize=function(){X.domEventDelegate=s.dom.getEventDelegate("body"),X.initialize()},$.initialize();const Z={},Q={__:Z};Z.poaHandler=function(e){e.preventDefault();try{acquireIO&&acquireIO.max()()}catch(e){console.warn(e)}},Z.cookieHandler=function(e){e.preventDefault();try{blueConicClient&&blueConicClient.event.publish("optin_optout_openPermissionLevelSelector")}catch(e){console.warn(e)}},Z.addEvents=function(){Z.domEventDelegate.on("click",".nm-j-poa",Z.poaHandler),Z.domEventDelegate.on("click",".nm-j-ext-cookie",Z.cookieHandler)},Z.initialize=function(){Z.addEvents()},Q.initialize=function(){Z.domEventDelegate=s.dom.getEventDelegate("body"),Z.initialize()},Q.initialize();const ee={},te={__:ee};ee.navFixed=!1,ee.handleNaviStateChanged=function(t){t.where===e.scroll.WHERE.ABOVE?(document.body.classList.add("nm-nav-fixed"),ee.navFixed=!0):ee.navFixed&&(document.body.classList.remove("nm-nav-fixed"),ee.navFixed=!1)},ee.addEvents=function(){e.scroll.register(".nm-navigation-scroll-check",{eventName:"navigation-changed"},ee.handleNaviStateChanged)},ee.initialize=function(){ee.addEvents(),document.body.classList.add("nm-not-sticky")},te.initialize=function(e){ee.eventBus=e,ee.initialize()};const ne={},oe={__:ne};ne.oDefaults={sSelectorModule:"j-action-usabilla"},ne.addEvents=function(){ne.domDelegate.on("click",".j-action-usabilla",ne.callExternalUsabillaModul)},ne.callExternalUsabillaModul=function(t){t&&t.preventDefault&&t.preventDefault();try{"function"==typeof window.usabilla_live?window.usabilla_live("click"):(console.warn("no usabilla: window.usabilla_live not defined"),ne.eventEmitter.trigger(e.appEvents.ERROR))}catch(t){console.warn("usabilla warn: something went wrong in window.usabilla_live: ",t),ne.eventEmitter.trigger(e.appEvents.ERROR)}},oe.initialize=function(e){ne.eventEmitter=e,ne.domDelegate=s.dom.getEventDelegate("body"),ne.addEvents()};const ae=[a,D,k,b,R,B,q,te,oe],re=e.signal.getEmitter();ae.forEach((e=>{try{e.initialize(re)}catch(e){console.error(e)}}))})(),i})()));
//# sourceMappingURL=audi-core-global.js.map