/*! For license information please see bundle.search-providers.js.LICENSE.txt */
/* nemo v170.0.0 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("core-utils"),require("microkernel")):"function"==typeof define&&define.amd?define("search-providers",["core-utils","microkernel"],e):"object"==typeof exports?exports["search-providers"]=e(require("core-utils"),require("microkernel")):t["search-providers"]=e(t["core-utils"],t.microkernel)}(globalThis,((t,e)=>(()=>{"use strict";var r={39:e=>{e.exports=t},214:t=>{t.exports=e}},i={};function a(t){var e=i[t];if(void 0!==e)return e.exports;var o=i[t]={exports:{}};return r[t](o,o.exports,a),o.exports}a.d=(t,e)=>{for(var r in e)a.o(e,r)&&!a.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var o={};return(()=>{a.r(o),a.d(o,{searchAudicode:()=>m});var t=a(39),e=a(214);class r{static get SEARCHPROVIDER_STORE_ID(){return"dbadSearchProviderStore"}static get SEARCHQUERY_STORE_ID(){return"dbadSearchQueryStore"}get searchResultStoreId(){return null}constructor(){e.stateRegistry.subscribeToStore(r.SEARCHQUERY_STORE_ID,(t=>{this.performSearch(t.searchQuery)})),this.registerResultStore()}async registerResultStore(){this.searchResultStoreId&&(await this.waitForProviderStore(),e.stateRegistry.triggerAction(r.SEARCHPROVIDER_STORE_ID,"addSearchProvider",{searchProvider:this.searchResultStoreId}))}waitForProviderStore(){return new Promise((t=>{e.stateRegistry.subscribeToStore(r.SEARCHPROVIDER_STORE_ID,(()=>{t()}))}))}performSearch(t){throw new Error("Implement performSearch in Subclass. (searchQuery: "+t+")")}publishResult(t,r){e.stateRegistry.triggerAction(this.searchResultStoreId,"update",{result:r,searchQuery:t})}setPreventSubmit(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e.stateRegistry.triggerAction(r.SEARCHPROVIDER_STORE_ID,"preventSubmit",{preventSubmit:t})}}const i="dbadAudicodeSearchStore";class n{constructor(){return n.instance||(this._initStore(),n.instance=this),n.instance}_initStore(){const t={update:this._update};e.stateRegistry.addStore(i,{result:null,searchQuery:null},t)}_update(t,e){return{...t,result:e.result,searchQuery:e.searchQuery}}}const c=new n;Object.freeze(c);const s=JSON.parse('{"P":{"hi":"https://mediaservice.audi.com/renderapi/v1/urls","I4":"4DWZjsGz","a":true}}'),d={exterior:{fullscreen:"aecwn8o1920x1152",flyout:"aecwn8o1920x600"},exterior_front:{fullscreen:"aecwn1o1920x1152",flyout:"aecwn1o1920x600"},exterior_back:{fullscreen:"aecwn6o1920x1152",flyout:"aecwn6o1920x600"},exterior_straight_front:{fullscreen:"aecwn3o1920x1152",flyout:"aecwn3o1920x600"},exterior_straight_back:{fullscreen:"aecwn5o1920x1152",flyout:"aecwn5o1920x600"},closeup_lights:{fullscreen:"aecwn2o1920x1152",flyout:"aecwn2o1920x600"},interior:{fullscreen:"aecwi1n1920x1152",flyout:"aecwi1n1920x600"},dashboard:{fullscreen:"aecwi2n1920x1152",flyout:"aecwi2n1920x600"}},u=Object.values(d).map((t=>[t?.flyout,t?.fullscreen]));function l(t,e){if(t&&t.length){const r=t.find((t=>t.config===e));return r?.url}return null}const h=t=>t?.startsWith("LC_PR"),g=async function(t){const e=t?.ave,r=t&&t["mbv-ids"];if(!e)return Promise.reject({});const i=e.split(","),a=i.slice(0,5),o=i.slice(5),n=i[3],c=i[4],g=i[2],m=i[1],f=t?.extColorCode?.selected,_=r?.exteriorColor||n,p=r?.interiorColor||c,v=r?.modelyear||t?.modelyear||g,S=m||r?.model||t?.model,y={client:s.P.I4,brand:"ALL",configs:[].concat(...u),live:s.P.a,modelRequests:[{modelCode:S,modelYear:v,exteriorColor:_,interiorColor:p,standardEquipments:o,mimeType:"image/png",...h(a[3])&&{aozEquipments:[f]}}]},b={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)};try{const t=await fetch(s.P.hi,b);if(t.ok)return t.json().then((t=>{const e=t.modelResults[0]?.urlResult.filter((t=>t?.url));return(t=>t?Object.entries(d).reduce(((e,r)=>({...e,[r[0]]:{fullscreen:l(t,r[1]?.fullscreen),flyout:l(t,r[1]?.flyout)}})),{}):[])(e)}));console.error("Response error from fetch images API: ",t)}catch(t){console.error("error occured when trying to fetch images from API:"+t)}};const m=new class extends r{get searchResultStoreId(){return i}async performSearch(e){let r=null;if(this.isPossibleAudicode(e)){this.setPreventSubmit(!0);try{const i=await this.loadAudicode(e);if(i)if(this.isVTPAudicode(i.configuration)){const e={audicode:i.audicode,url:i.configuration.audicode["other-url"]};r=t.template.render('\n{{var target = SETUPS.get(\'scope.nemo.audicode.externallink\') ? \'target="blank"\' : \'\';}}\n<audi-configurator-search-vtp-audicode class="search-audicode" data-module="search-vtp-audicode">\n\t<div class="search-audicode__top">\n\t\t<div class="search-audicode__background-color-container"></div>\n\t\t<div class="search-audicode__text-container">\n\t\t\t<div class="search-audicode__audicode audi-copy-s">{{=window.i18n[\'search-layer.your-audicode\']}} {{=it.audicode}}</div>\n\t\t\t<h3 class="audi-headline-order-3 search-audicode__vtp-headline">{{=window.i18n[\'search-layer.available-cars\']}}</h3>\n\t\t\t<div class="audi-copy-m search-audicode__vtp-carinfo">{{=window.i18n[\'search-layer.available-cars-info\']}}</div>\n\t\t</div>\n\t</div>\n\t<div class="search-audicode__middle">\n\t\t<div class="search-audicode__background-color-container search-audicode__background-color-container--size60"></div>\n\t\t<div class="search-audicode__image-container search-audicode__image-container--vtp">\n\t\t\t<img class="search-audicode__image" src="{{=SETUPS.get(\'nemo.url.assets\')+"/img/fallback/fb-audicode-flyout.png"}}" alt="Fallback Image">\n\t\t</div>\n\t</div>\n\t<div class="search-audicode__text-container search-audicode__bottom">\n\t\t<a href="{{=it.url}}" {{=target}} class="audi-j-quick-search-result-tracking audi-link-m audi-link-m--arrow search-audicode__link">\n\t\t\t<span class="audi-link-m__text">{{=window.i18n[\'search-layer.your-car\']}}</span>\n\t\t\t<svg class="audi-link-m__icon">\n\t\t\t\t<use xlink:href={{=SETUPS.get(\'coreci.url.assets\')+"/icons/svg/forward-small.svg#audi-icon-forward-small"}}></use>\n\t\t\t</svg>\n\t\t</a>\n\t\t<p class="audi-copy-s search-audicode__reference">\n\t\t\t<span class="search-audicode__reference-label">{{=window.i18n[\'search-layer.label.disclaimer\']}}: </span>\n\t\t\t<span class="search-audicode__reference-text">{{=window.i18n[\'search-layer.vtp-warning\']}}</span>\n\t\t</p>\n\t</div>\n</audi-configurator-search-vtp-audicode>\n',e)}else{const e=await g(i.configuration.configuration),a={audicode:i.audicode,configuration:i.configuration.configuration,mediaservice:SETUPS.get("nemo.url.mediaservice"),images:e};r=t.template.render('\n{{?!!it.audicode}}\n\t{{?!!it.configuration}}\n\t\t{{? SETUPS.get(\'scope.nemo.audicode.externallink\')}}\n\t\t\t{{var target = "target=\'blank\'";}}\n\t\t{{??}}\n\t\t\t{{var target = "";}}\n\t\t{{?}}\n\t\t{{var link = \'/\' + it.audicode;}}\n\t\t{{?!!it.configuration.extColorCode && !!it.configuration.extColorCode.selected}}\n\t\t\t{{var selected = it.configuration.extColorCode.selected;}}\n\t\t\t{{var backgroundcolor = \'extcolor--\' + selected;}}\n\t\t\t{{var textcolor = \'extcolor-text--\' + selected;}}\n\t\t{{??}}\n\t\t\t{{var selected = "";}}\n\t\t\t{{var backgroundcolor = "";}}\n\t\t\t{{var textcolor = "";}}\n\t\t{{?}}\n\t\t<audi-configurator-search-audicode class="search-audicode" data-module="search-audicode">\n\t\t\t<div class="search-audicode__top">\n\t\t\t\t<div class="search-audicode__background-color-container {{=backgroundcolor}}"></div>\n\t\t\t\t<div class="search-audicode__text-container {{=textcolor}}">\n\t\t\t\t\t<div class="search-audicode__audicode audi-copy-s">{{=window.i18n[\'search-layer.your-audicode\']}} {{=it.audicode}}</div>\n\t\t\t\t\t{{?!!it.configuration}}\n\t\t\t\t\t\t{{?!!it.configuration.carlineName}}\n\t\t\t\t\t\t\t<h3 class="audi-headline-order-3 search-audicode__carline">{{=it.configuration.carlineName}}</h3>\n\t\t\t\t\t\t{{?}}\n\t\t\t\t\t\t{{?!!it.configuration.description}}\n\t\t\t\t\t\t\t<div class="audi-copy-s search-audicode__engine">{{=it.configuration.description}}</div>\n\t\t\t\t\t\t{{?}}\n\t\t\t\t\t\t{{?!!it.configuration.price}}\n\t\t\t\t\t\t\t<div class="audi-copy-m search-audicode__price">{{=it.configuration.price}}</div>\n\t\t\t\t\t\t{{?}}\n\t\t\t\t\t{{?}}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="search-audicode__middle">\n\t\t\t\t<div class="search-audicode__background-color-container search-audicode__background-color-container--size60 {{=backgroundcolor}}"></div>\n\t\t\t\t<div class="search-audicode__image-container">\n\t\t\t\t\t{{?!!it.configuration && it.images && it.images[\'exterior\'] && it.images[\'exterior\'][\'flyout\']}}\n\t\t\t\t\t\t<picture>\n\t\t\t\t\t\t\t<source media="(max-width: 427px)" srcset="{{=it.mediaservice}}{{=it.images[\'exterior\'][\'flyout\']}}?imwidth=470">\n\t\t\t\t\t\t\t<img class="search-audicode__image" src="{{=it.mediaservice}}{{=it.images[\'exterior\'][\'flyout\']}}?imwidth=654">\n\t\t\t\t\t\t</picture>\n\t\t\t\t\t{{??}}\n\t\t\t\t\t\t<img class="search-audicode__image" src="{{=SETUPS.get(\'nemo.url.assets\')+"/img/fallback/fb-audicode-flyout.png"}}" alt="Fallback Image">\n\t\t\t\t\t{{?}}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="search-audicode__text-container search-audicode__bottom">\n\t\t\t\t<div>\n\t\t\t\t\t<a href="{{=link}}" {{=target}} class="audi-j-quick-search-result-tracking audi-link-m audi-link-m--arrow search-audicode__link">\n\t\t\t\t\t\t<span class="audi-link-m__text">{{=window.i18n[\'search-layer.load-configuration\']}}</span>\n\t\t\t\t\t\t<svg class="audi-link-m__icon">\n\t\t\t\t\t\t\t<use xlink:href={{=SETUPS.get(\'coreci.url.assets\')+"/icons/svg/forward-small.svg#audi-icon-forward-small"}}></use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t\t<p class="audi-copy-s search-audicode__reference">\n\t\t\t\t\t<span class="search-audicode__reference-label">{{=window.i18n[\'search-layer.label.disclaimer\']}}:</span>\n\t\t\t\t\t<span class="search-audicode__reference-text">{{=window.i18n[\'search-layer.configuration-overwrite-warning\']}}</span>\n\t\t\t\t</p>\n\t\t\t\t{{? !SETUPS.get(\'scope.nemo.hide.consumption-entries\')}}\n\t\t\t\t\t{{? it.configuration.techdata && (it.configuration.techdata[\'consumption-combined\'] || it.configuration.techdata[\'carbon-dioxide-emissions\'] || it.configuration.techdata[\'efficiency-class\'])}}\n\t\t\t\t\t\t{{? it.configuration.techdata[\'consumption-combined\']}}\n\t\t\t\t\t\t\t<dl class="audi-copy-s search-audicode__disclaimer">\n\t\t\t\t\t\t\t\t<dt class="search-audicode__disclaimer-label">{{=window.i18n[\'nemo.ui.consumption-combined\']}}*:</dt>\n\t\t\t\t\t\t\t\t<dd class="search-audicode__disclaimer-value">{{=it.configuration.techdata[\'consumption-combined\']}}</dd>\n\t\t\t\t\t\t\t</dl>\n\t\t\t\t\t\t{{?}}\n\t\t\t\t\t\t{{? it.configuration.techdata[\'carbon-dioxide-emissions\']}}\n\t\t\t\t\t\t\t<dl class="audi-copy-s search-audicode__disclaimer">\n\t\t\t\t\t\t\t\t<dt class="search-audicode__disclaimer-label">{{=window.i18n[\'nemo.ui.emission-combined\']}}*:</dt>\n\t\t\t\t\t\t\t\t<dd class="search-audicode__disclaimer-value">{{=it.configuration.techdata[\'carbon-dioxide-emissions\']}}</dd>\n\t\t\t\t\t\t\t</dl>\n\t\t\t\t\t\t{{?}}\n\t\t\t\t\t\t{{? !SETUPS.get(\'scope.nemo.hide.eec-entry\')}}\n\t\t\t\t\t\t\t{{? it.configuration.techdata[\'efficiency-class\']}}\n\t\t\t\t\t\t\t\t<dl class="audi-copy-s search-audicode__disclaimer">\n\t\t\t\t\t\t\t\t\t<dt class="search-audicode__disclaimer-label">{{=window.i18n[\'nemo.ui.efficiency-class\']}}:</dt>\n\t\t\t\t\t\t\t\t\t<dd class="search-audicode__disclaimer-value">{{=it.configuration.techdata[\'efficiency-class\']}}</dd>\n\t\t\t\t\t\t\t\t</dl>\n\t\t\t\t\t\t\t{{?}}\n\t\t\t\t\t\t{{?}}\n\t\t\t\t\t{{?}}\n\t\t\t\t{{?}}\n\t\t\t</div>\n\t\t</audi-configurator-search-audicode>\n\t{{?}}\n{{?}}',a)}}catch(i){const a={errorMessage:this.getErrorMessage(i),pdfLink:this.getPdfLink(e,i)};r=t.template.render('\n<audi-configurator-search-audicode-error class="search-audicode" data-module="search-audicode">\n\t<div class="search-audicode__text-container search-audicode__top search-audicode__bottom">\n\t\t<p class="audi-copy-s search-audicode__error">{{=it.errorMessage}}</p>\n\t\t{{?it.pdfLink}}\n\t\t\t<div class="search-audicode__error-pdflink">\n\t\t\t\t<a class="audi-link-s audi-link-s--arrow-front" href="{{=it.pdfLink.url}}" target="_blank">\n\t\t\t\t\t<span class="audi-link-s__text">{{=it.pdfLink.label}}</span>\n\t\t\t\t\t<svg class="audi-link-s__icon">\n\t\t\t\t\t\t<use xlink:href="{{=SETUPS.get(\'coreci.url.assets\')+"/icons/svg/print-small.svg#nm-icon-print-small"}}"></use>\n\t\t\t\t\t</svg>\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t{{?}}\n\t</div>\n</audi-configurator-search-audicode-error>',a)}}this.publishResult(e,r)}getPdfLink(t,e){if("AUDICODE_CONF_NOT_VALID"===e.id&&SETUPS.get("scope.nemo.audicode.not_valid_pdflink")){const e="search-layer.audicode-pdf";return{label:window.i18n&&window.i18n[e]?window.i18n[e]:"PDF anzeigen",url:SETUPS.get("nemo.pdf.url")+"/audicode/"+t}}return null}isPossibleAudicode(t){return!!t&&!this.isStopword(t)&&this.matchesAudicodePattern(t)}isVTPAudicode(t){return t.audicode&&t.audicode.application&&"VTP"===t.audicode.application}isStopword(t){const e=SETUPS.get("nemo.search.audicodestopwords");return!!e&&e.split(",").includes(t)}matchesAudicodePattern(t){return!!t.match(/^[Aa]{1}[a-zA-Z0-9]{7}$/)}async loadAudicode(t){const e=await this.loadConfigurationByAudiCode(t);return e?{audicode:t.toUpperCase(),configuration:e}:null}async loadConfigurationByAudiCode(t){const e=SETUPS.get("nemo.url.dpu")+"audicode?"+new URLSearchParams({audicode:t.toUpperCase(),context:SETUPS.get("nemo.default.header").context}).toString();return fetch(e,{credentials:"include"}).then((t=>{if(t.ok)return t.json();this.setupAndThrowError({statuscode:t.status})})).then(this.checkDPUresponseStatus.bind(this))}setupAndThrowError(t){const e=new Error;throw e.status=t.statuscode,t.audicode&&t.audicode.message&&(e.name="custom-dpu-error"),t.header&&t.header.error&&(e.id=t.header.error.id,e.message=t.header.error.message?t.header.error.message:t.header.statusmessage),e}checkDPUresponseStatus(t){if(t.header&&t.header.statuscode){const e=Math.floor(t.header.statuscode/100);3!==e&&5!==e||this.setupAndThrowError(t)}return t}getErrorMessage(t){const e=this.getErrorMessageFromI18N(t),r=e||t.message;return r||this.getErrorMessageFromI18N("DEFAULT")}getErrorMessageFromI18N(t){const e="string"==typeof t?t:t.id;return window.i18n["error.message."+e]}};class f{constructor(){return f.instance||(this._initStore(),f.instance=this),f.instance}_initStore(){const t={addSearchProvider:this._addSearchProvider,preventSubmit:this._preventSubmit};e.stateRegistry.addStore("dbadSearchProviderStore",{searchProviderList:[],preventSubmit:!1},t)}_addSearchProvider(t,e){return t.searchProviderList.push(e.searchProvider),t}_preventSubmit(t,e){return{...t,preventSubmit:e.preventSubmit}}}const _=new f;Object.freeze(_);class p{constructor(){return p.instance||(this._initStore(),p.instance=this),p.instance}_initStore(){const t={clear:this._clear,update:this._update};e.stateRegistry.addStore("dbadSearchQueryStore",{searchQuery:null},t)}_clear(t){return{...t,searchQuery:null}}_update(t,e){return{...t,searchQuery:e.searchQuery}}}const v=new p;Object.freeze(v)})(),o})()));
//# sourceMappingURL=bundle.search-providers.js.map