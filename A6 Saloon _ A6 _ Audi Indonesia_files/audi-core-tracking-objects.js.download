/*! @oneaudi/audi-core-tracking 7.2.0 - Tue, 28 Nov 2023 09:48:05 GMT
License information can be found in audi-core-tracking-objects.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("core-tracking-objects",[],t):"object"==typeof exports?exports["core-tracking-objects"]=t():e["core-tracking-objects"]=t()}(self,(()=>(()=>{"use strict";var e={d:(t,a)=>{for(var s in a)e.o(a,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:a[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{ClickEventHelperDom:()=>o,CustomEventService:()=>N,PageObjectArticleAttributes:()=>y,PageObjectDefaultAttributes:()=>O,PageObjectDefaultCategory:()=>T,PageObjectDefaultPageInfo:()=>k,cartService:()=>E,clickEventObjectLayerClose:()=>F,clickEventObjectLayerOpen:()=>B,clickEventObjectTab:()=>Q,clickEventService:()=>l,componentService:()=>n,dealerService:()=>p,pageService:()=>j,productService:()=>w,searchService:()=>R,stateEventService:()=>_,userService:()=>I});const a=new class{mergeObjects(){const e=e=>e&&"object"==typeof e;for(var t=arguments.length,a=new Array(t),s=0;s<t;s++)a[s]=arguments[s];return a.reduce(((t,a)=>(Object.keys(a).forEach((s=>{const n=t[s],i=a[s];Array.isArray(n)&&Array.isArray(i)?t[s]=i:e(n)&&e(i)?t[s]=this.mergeObjects(n,i):t[s]=i})),t)),{})}flattenAndMergeObjects(e,t){const a=[];for(let s of e)for(let e of s)a.push(this.mergeObjects(...t,e));return a}static toMMSS(e){return e>=3600?new Date(1e3*e).toISOString().substr(11,8):new Date(1e3*e).toISOString().substr(14,5)}static debounce(e,t,a){let s;return function(){const n=this,i=arguments,r=a&&!s;clearTimeout(s),s=setTimeout((function(){s=null,a||e.apply(n,i)}),t),r&&e.apply(n,i)}}static withLastParameter(e){let t=null;return function(){null!==t?(e.call(this,...t,...arguments),t=arguments):t=arguments}}};class s{constructor(){if(s._instance)return s._instance;this.registeredCallbacks=[],s._instance=this}register(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("function"!=typeof e)throw new Error("bad parameter: callback_ is not of type function");const a=0===this.registeredCallbacks.length?1:this.registeredCallbacks.length;t?this.registeredCallbacks[0]=e:this.registeredCallbacks[a]=e}unregister(e){let t=this.registeredCallbacks.indexOf(e);-1!==t&&this.registeredCallbacks.splice(t,1)}ensureKnownChildFaLoadedInComponentArray(e,t){const a=new Map;if(a.set("profile-completion-loader",["fa-profile-completion","fa-mev-registration"]),t&&void 0!==t){for(let a=0;a<t.length;a++)void 0===t[a].attributes&&e.push(t[a]);for(const s of a.keys()){if(e.find((e=>e?.componentInfo?.componentID==s))){a.get(s).forEach((a=>{const s=t.find((e=>e?.componentInfo?.componentID==a));s&&!e.find((e=>e.componentInfo?.componentID==a))&&e.push(s)}))}}}return e}getComponentArray(){const e=[],t=document.querySelectorAll("feature-app");let a=window.digitalData.component;if(a&&void 0!==a)for(let s=0;s<t.length;s++){const n=t[s];if((!n.hasAttribute("data-audi-core-tracking-include")||"true"===n.getAttribute("data-audi-core-tracking-include"))&&!n.hasAttribute("data-module")){const n=t[s].id;for(let t=0;t<a.length;t++)if(a[t].componentInfo&&a[t].componentInfo.componentID==n){e.push(a[t]);break}}}return this.ensureKnownChildFaLoadedInComponentArray(e,a)}async getData(){const e=document.querySelectorAll("[data-module]"),t=e.length;let s=this.getComponentArray();for(let n=0;n<t;n+=1){const t=[],i=[];for(let a of this.registeredCallbacks){const s=await a(e[n],n);s instanceof Array&&s.length>0?i.push(s):"object"==typeof s&&s!==[]&&t.push(s)}0===i.length?s.push(a.mergeObjects(...t)):s=s.concat(a.flattenAndMergeObjects(i,t))}return s}}const n=new s;class i{constructor(){if(i._instance)return i._instance;n.register(i.getData,!0),i._instance=this}static async getData(e,t){return null===e?null:{attributes:{implementer:1,moduleNumber:t,subNumber:0,version:""},category:{primaryCategory:""},componentInfo:{componentID:t+"-0",componentName:i.getComponentName(e)}}}static getComponentName(e){return e.dataset.module?e.dataset.module:""}}new i;class r{constructor(){if(r._instance)return r._instance;n.register(r.getData),r._instance=this}static async getData(e,t){const a=[];if(null===e)return a;const s=e.querySelectorAll(".audi-j-module-item").length;for(let e=0;e<s;e+=1)a.push({attributes:{subNumber:e},componentInfo:{componentID:t+"-"+e}});return a}}new r;class c{constructor(){if(c._instance)return c._instance;n.register(c.getData),c._instance=this}static async getData(e,t){const a=[];if(null===e)return a;const s=e.querySelectorAll(".nm-j-teaser-item"),n=s.length;for(let e=0;e<n;e+=1){const n=s[e];let i="";i=n.querySelector(".nm-j-teaser-title")?n.querySelector(".nm-j-teaser-title").innerText.trim():n.innerText.trim(),a.push({attributes:{subNumber:e,teaserTitle:i},componentInfo:{componentID:t+"-"+e}})}return a}}new c;class o{static getTargetUrl(e){return e.currentTarget&&e.currentTarget.href?e.currentTarget.href:""}static getLabel(e){if(!e.currentTarget)return"";return(e.currentTarget.textContent?e.currentTarget.textContent:"").trim()}static getClickID(e){return e.currentTarget&&e.currentTarget.id?e.currentTarget.id:""}static getElementName(e){const t=e.target;let a="other";return e.currentTarget instanceof HTMLElement?(o._isTextLink(t)||o._isTextLinkArrow(t)?a="text link":o._isButton(t)?a="button":!o._isIcon(t)||o._isTextLinkArrow(t)||o._isButton(t)?o._isImage(t)&&(a="image"):a="icon",a):a}static getTargetClassList(e){return e&&e.currentTarget&&e.currentTarget.classList?e.currentTarget.classList:0}static getTarget(e){return e?e.currentTarget:0}static _isTextLink(e){return!!e.classList&&(e.classList.contains("audi-link-s")||e.classList.contains("audi-link-m")||e.classList.contains("audi-copy-s")||e.classList.contains("audi-copy-m")||e.classList.contains("audi-headline-order-1")||e.classList.contains("audi-headline-order-2")||e.classList.contains("audi-headline-order-3")||null!==e.parentElement&&(e.parentElement.classList.contains("audi-link-s")||e.parentElement.classList.contains("audi-link-m")||e.parentElement.classList.contains("audi-copy-s")||e.parentElement.classList.contains("audi-copy-m")))}static _isButton(e){return!!e.classList&&(e.classList.contains("audi-button")||null!==e.parentElement&&(e.parentElement.classList.contains("audi-button")||e.parentElement.classList.contains("audi-button__icon")))}static _isIcon(e){return!e.classList||!e.tagName||("svg"===e.tagName.toLowerCase()||null!==e.parentElement&&"svg"===e.parentElement.tagName.toLowerCase())}static _isImage(e){return!!e.tagName&&("img"===e.tagName.toLowerCase()||"picture"===e.tagName.toLowerCase())}static _isTextLinkArrow(e){return o._isIcon(e)&&(e.closest(".audi-link-m--arrow")||e.closest(".audi-link-s--arrow"))}}const l=new class{constructor(){this.eventObjectCallbacks=[],this.getData=this.getData.bind(this),this.clickSelectors=["a",".audi-button",".audi-j-clicktracking-element"],this._getRegisteredEventObjects=this._getRegisteredEventObjects.bind(this)}registerClickSelector(e){this.clickSelectors.push(e)}register(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=0===this.eventObjectCallbacks.length?1:this.eventObjectCallbacks.length;t?this.eventObjectCallbacks[0]=e:this.eventObjectCallbacks[a]=e}unregister(e){let t=this.eventObjectCallbacks.indexOf(e);this.eventObjectCallbacks.splice(t,1)}async getData(e,t){const a=this._retrieveFirstMatchedElement(e),s=e;if(!a)return{};const n=this._serializeEventData(s,a,t),i=await this._getRegisteredEventObjects(n);return this._mergeObjects(...i)}_retrieveFirstMatchedElement(e){let t;if(e)for(const a of this.clickSelectors)if(t=e.closest(a),t)return t;return!1}async _getRegisteredEventObjects(e){let t=[];for(let a in this.eventObjectCallbacks)if(a&&this.eventObjectCallbacks[a]){let s=await this.eventObjectCallbacks[a](e);t.push(s)}return t}_getModule(e){let t=e.closest("[data-module]");return t?t.getAttribute("data-module"):""}_serializeEventData(e,t,a){return{currentTarget:t,currentURL:a,moduleName:this._getModule(t),target:e}}_mergeObjects(){const e=e=>e&&"object"==typeof e;for(var t=arguments.length,a=new Array(t),s=0;s<t;s++)a[s]=arguments[s];return a.reduce(((t,a)=>(Object.keys(a).forEach((s=>{const n=t[s],i=a[s];Array.isArray(n)&&Array.isArray(i)?t[s]=i:e(n)&&e(i)?t[s]=this._mergeObjects(n,i):t[s]=i})),t)),{})}};class g{constructor(){if(g._instance)return g._instance;l.register(g.getData,!0),g._instance=this}static async getData(e){return{attributes:{clickID:o.getClickID(e),componentName:e.moduleName,currentURL:e.currentURL,elementName:o.getElementName(e),label:o.getLabel(e),pos:"",targetURL:o.getTargetUrl(e),value:""},eventInfo:{eventAction:"internal_link",eventName:"generic"}}}}new g;class u{constructor(){if(u._instance)return u._instance;l.register(u.getData),u._instance=this}static async getData(e){const t=o.getTargetUrl(e);return u._isExternalLink(t)?{eventInfo:{eventAction:"exit_link"}}:{}}static _isExternalLink(e){return(-1!==e.indexOf("http")||-1!==e.indexOf("//"))&&!this._isLinkOfSameDomain(e,window.location)}static _isLinkOfSameDomain(e,t){let a=e.split("/"),s=t.hostname,n=t.hostname+":"+t.port;return a[2]===s||a[2]===n}}new u;class h{constructor(){if(h._instance)return h._instance;l.register(h.getData),h._instance=this}static get DOWNLOAD_FILE_TYPES(){return["doc","docx","eps","xls","ppt","pptx","pdf","xlsx","tab","csv","zip","txt","vsd","vxd","xml","js","css","rar","exe","wma","mov","avi","wmv","mp3","wav","m4v","ics"]}static async getData(e){const t=o.getTargetUrl(e);if(!h._isDownloadLink(t))return{};return{attributes:{value:h._getFileType(t).toUpperCase()},eventInfo:{eventAction:"download"}}}static _isDownloadLink(e){let t=h._getFileType(e);return""!==t&&-1!==h.DOWNLOAD_FILE_TYPES.indexOf(t.toLowerCase())}static _getFileType(e){let t=e.split("/"),a=t[t.length-1].split(".");return a.length<=1?"":a[a.length-1]}}new h;class b{constructor(){if(b._instance)return b._instance;l.register(b.getData),b._instance=this}static async getData(e){return b._isLinkWithinTeaser(e)?{attributes:{value:b._getTeaserTitle(e)},eventInfo:{eventName:"teaser click"}}:{}}static _isLinkWithinTeaser(e){return null!==e.currentTarget.closest(".nm-j-teaser-module")}static _getTeaserTitle(e){let t=e.currentTarget.innerText.trim();const a=e.currentTarget.closest(".nm-j-teaser-module");return a&&a.querySelector(".nm-j-teaser-title")&&(t=a.querySelector(".nm-j-teaser-title").innerText.trim()),t}}new b;class d{constructor(){if(d._instance)return d._instance;l.register(d.getData),d._instance=this}static async getData(e){const t=o.getTargetUrl(e);return d._isEmailLink(t)?{attributes:{targetURL:d._getEmailAddress(t),value:""},eventInfo:{eventAction:"email"}}:{}}static _isEmailLink(e){return!!e&&0===e.indexOf("mailto:")}static _getEmailAddress(e){const t=e?e.split(":"):[];return t.length<1||"mailto"!==t[0]?"":t[1]}}new d;const p=new class{constructor(){this.dealerObjectCallbacks=[],this.getData=this.getData.bind(this),this._getRegisteredDealerObjects=this._getRegisteredDealerObjects.bind(this)}register(e,t){let a=0===this.dealerObjectCallbacks.length?1:this.dealerObjectCallbacks.length;t?this.dealerObjectCallbacks[0]=e:this.dealerObjectCallbacks[a]=e}unregister(e){let t=this.dealerObjectCallbacks.indexOf(e);this.dealerObjectCallbacks.splice(t,1)}async getData(){return(await this._getRegisteredDealerObjects()).filter((e=>Object.getOwnPropertyNames(e).length>0)).reduce(((e,t)=>e.concat(t)),[])}async _getRegisteredDealerObjects(){let e=[];for(let t in this.dealerObjectCallbacks)if(t&&this.dealerObjectCallbacks[t]){let a=await this.dealerObjectCallbacks[t]();a!=={}&&e.push(a)}return e}};class m{constructor(){if(m._instance)return m._instance;p.register(m.getData,!0),m._instance=this}static async getData(){return{}}}new m;const _=new class{constructor(){this.eventObjectCallbacks=[],this.getData=this.getData.bind(this),this._getRegisteredEventObjects=this._getRegisteredEventObjects.bind(this)}register(e,t){let a=0===this.eventObjectCallbacks.length?1:this.eventObjectCallbacks.length;t?this.eventObjectCallbacks[0]=e:this.eventObjectCallbacks[a]=e}unregister(e){let t=this.eventObjectCallbacks.indexOf(e);this.eventObjectCallbacks.splice(t,1)}async getData(e){let t=await this._getRegisteredEventObjects(e);return this._mergeObjects(...t)}async _getRegisteredEventObjects(e){let t=[];for(let a in this.eventObjectCallbacks)if(a&&this.eventObjectCallbacks[a]){let s=await this.eventObjectCallbacks[a](e);t.push(s)}return t}_mergeObjects(){const e=e=>e&&"object"==typeof e;for(var t=arguments.length,a=new Array(t),s=0;s<t;s++)a[s]=arguments[s];return a.reduce(((t,a)=>(Object.keys(a).forEach((s=>{const n=t[s],i=a[s];Array.isArray(n)&&Array.isArray(i)?t[s]=i:e(n)&&e(i)?t[s]=this._mergeObjects(n,i):t[s]=i})),t)),{})}};class f{constructor(){if(f._instance)return f._instance;_.register(f.getData,!0),f._instance=this}static async getData(){return{attributes:{clickID:"",componentName:"",currentURL:window.location.href,elementName:"",label:"",pos:"",targetURL:"",value:""},eventInfo:{eventAction:"page_load",eventName:"generic"}}}}new f;class S{constructor(){if(S._instance)return S._instance;_.register(S.getData),S._instance=this}static async getData(e){if("PAGE_READY"!==e&&"LAYER_LOADED"!==e&&"LAYER_CLOSED"!==e)return{};return{attributes:{clickID:"",componentName:"",currentURL:window.location.href,elementName:"",label:"",pos:"",targetURL:"",value:""},eventInfo:{eventAction:"step",eventName:"generic"}}}}new S;class y{_getArticleFormat(){return"undefined"!=typeof SETUPS&&SETUPS.get("article.format")&&""!==SETUPS.get("article.format")?SETUPS.get("article.format"):""}_getArticlePublicationDate(){return"undefined"!=typeof SETUPS&&SETUPS.get("article.publicationDate")&&""!==SETUPS.get("article.publicationDate")?SETUPS.get("article.publicationDate"):""}_getArticleReadingTime(){return"undefined"!=typeof SETUPS&&SETUPS.get("article.readingTime")&&""!==SETUPS.get("article.readingTime")?SETUPS.get("article.readingTime"):"0"}_getArticleId(){return"undefined"!=typeof SETUPS&&SETUPS.get("article.id")&&""!==SETUPS.get("article.id")?SETUPS.get("article.id"):""}_getArticleContentTags(){return"undefined"!=typeof SETUPS&&SETUPS.get("article.contentTags")&&""!==SETUPS.get("article.contentTags")?SETUPS.get("article.contentTags").split(","):[]}_getArticleCategory(){return"undefined"!=typeof SETUPS&&SETUPS.get("article.category")&&""!==SETUPS.get("article.category")?SETUPS.get("article.category"):""}_getArticleUpdateDate(){return"undefined"!=typeof SETUPS&&SETUPS.get("article.updateDate")&&""!==SETUPS.get("article.updateDate")?SETUPS.get("article.updateDate"):""}getArticleAttributes(){return{articleCategory:this._getArticleCategory(),articleContentTags:this._getArticleContentTags(),articleFormat:this._getArticleFormat(),articleID:this._getArticleId(),articlePublicationDate:this._getArticlePublicationDate(),articleReadingTime:this._getArticleReadingTime(),articleUpdateDate:this._getArticleUpdateDate()}}}class O{getApplicationName(){if(document){const e=document.querySelector("meta[name=applicationName]");if(e){const t=e.getAttribute("content");if(t&&""!=t)return t}}if("undefined"!=typeof SETUPS&&SETUPS.get("page.template")&&""!==SETUPS.get("page.template")){switch(SETUPS.get("page.template")){case"oneshop-page":return"oneshop";case"nextgen-configurator-page":case"nextgen-configurator-summary":return"nemo";case"myaudipage":case"myaudi-emptypage":case"focus-page":return"myaudi 3.0-main";default:return"cms"}}return"cms"}getApplicationVersion(){let e="",t=document.getElementsByClassName("application-version");return t.length>0?e=t[0].getAttribute("data-version")||"":document.querySelectorAll(".nm-version-info dd")&&document.querySelectorAll(".nm-version-info dd").length>0&&(e=document.querySelectorAll(".nm-version-info dd")[1].innerHTML),e}getImplementer(){return 1}getSite(){if(document){const e=document.querySelector("meta[name=site]");if(e){const t=e.getAttribute("content");if(t&&""!=t)return t}}if("undefined"!=typeof SETUPS&&SETUPS.get("page.template")&&""!==SETUPS.get("page.template")){switch(SETUPS.get("page.template")){case"myaudipage":case"myaudi-emptypage":case"focus-page":return"myaudi 3.0";default:return"product portal"}}return"product portal"}}class T{getDisplayType(e){return this._hasSubString(e,"layer")?"layer":"default"}getPageType(e){if(document){const e=document.querySelector("meta[name=pageType]");if(e){const t=e.getAttribute("content");if(t&&""!=t)return t}}let t="standardPage",a="";return window.SETUPS&&window.SETUPS.get("page.template")&&(a=window.SETUPS.get("page.template")),"nextgen-configurator-page"==a?t="nextGenConfigOnePager":"nextgen-configurator-summary"==a?t="nextGenConfigSummary":this._hasElement(document,".nm-homepage")?t="homepage":this._hasElement(document,"#nm_mofi")?t="modelFinder":e&&e.querySelectorAll&&this._hasElement(e,".nm-content")&&("nemo"===this._getDataType(e.querySelectorAll(".nm-content")[0])?t=this._getPageTypeForNemo(e.querySelectorAll(".nm-content")[0]):"articlePage"===this._getDataTemplate(e.querySelectorAll(".nm-content")[0])&&(t="articlePage")),t}_getPageTypeForNemo(e){let t="configurableModel",a=this._getDataTemplate(e);return"home"===a?t="configurableHome":"summary"===a&&(t="configurationSummary"),t}_getDataType(e){let t="";return e&&e.getAttribute("data-type")&&(t=e.getAttribute("data-type")),t}_getDataTemplate(e){let t="";return e&&e.getAttribute("data-template")&&(t=e.getAttribute("data-template")),t}_hasElement(e,t){return e.querySelectorAll(t)&&e.querySelectorAll(t).length>0}_hasSubString(e,t){return-1!==e.indexOf(t)}}class k{getPageID(e,t){let a=t;return this._hasSubString(e,"jslayer=")?a=this._getPageIdForJsLayer(a,e):this._hasSubString(e,"layer=")?a=this._getSubStringByMarker(e,"layer="):this._hasSubString(e,"page=")&&(a=this._getSubStringByMarker(e,"page=")),a=this._removeTrailingHtmlString(a),a}_getPageIdForJsLayer(e,t){let a=this._getSubStringByMarker(t,"jslayer="),s=e;return this._hasSubString(t,"page=")&&(s=this._getSubStringByMarker(t,"page=")),s=this._removeTrailingHtmlString(s),s+"/"+a}getPageName(e){let t=this._getDocumentTitle();return e&&e.getElementById("nm-page-title")&&(t=e.getElementById("nm-page-title").innerText),t}_getDocumentTitle(){let e="";return document.getElementsByTagName("title")&&document.getElementsByTagName("title")[0]&&(e=document.getElementsByTagName("title")[0].innerText),e}getDestinationUrl(){return window.location.href}getReferringUrl(){return document.referrer||""}getSysEnv(e){let t="production";return this._hasSubString(e,"local")||this._hasSubString(e,"aem")||this._hasSubString(e,"nemo")||this._hasSubString(e,"127.0.0.1")?t="development":(this._hasSubString(e,"pre-")||this._hasSubString(e,"test-"))&&(t="staging"),t}getBreadCrumbs(e,t){let a=[],s=this.getPageID(e,t);const n=this._getOffsetIndexId(s);return this.getPageID(e,t).split("/").forEach((function(e,t){t>n&&""!==e&&a.push(e)})),a}getMarket(e,t){let a="";return a=this._hasLocalMarket()?this._getLocalMarket():this._getMarketFromPageID(e,t)?this._getMarketFromPageID(e,t):a,a.toUpperCase()}_hasLocalMarket(){return this._hasSetupsValue("LocaleCountry")||this._hasSetupsValue("nemo.locale.country")}_getLocalMarket(){let e="";return this._hasSetupsValue("LocaleCountry")?e=this._getSetupsValue("LocaleCountry"):this._hasSetupsValue("nemo.locale.country")&&(e=this._getSetupsValue("nemo.locale.country")),e}_getMarketFromPageID(e,t){let a="",s=this.getPageID(e,t).split("/");return s&&s[3]&&(a=s[3]),a}getLanguage(e,t){let a="";return a=this._hasLocalLanguage()?this._getLocalLanguage():this._getLanguageFromPageID(e,t),a.toLowerCase()}_hasLocalLanguage(){return this._hasSetupsValue("LocaleLanguage")||this._hasSetupsValue("nemo.locale.language")}_getOffsetIndexId(e){let t=0;return/^\/(\w|-){2,4}\/(brand|web|touch)\/(\w|-){2,}/gi.test(e)?t=3:/^\/(\w|-){2,4}\//gi.test(e)&&(t=1),t}_getLocalLanguage(){let e="";return this._hasSetupsValue("LocaleLanguage")?e=this._getSetupsValue("LocaleLanguage"):this._hasSetupsValue("nemo.locale.language")&&(e=this._getSetupsValue("nemo.locale.language")),e}_getLanguageFromPageID(e,t){let a="",s=this.getPageID(e,t).split("/");return s&&s[3]&&(a=s[3]),a.toLowerCase()}_hasSetupsValue(e){let t=!1;return SETUPS&&SETUPS.get(e)&&""!==SETUPS.get(e)&&(t=!0),t}_getSetupsValue(e){let t="";return SETUPS&&SETUPS.get(e)&&""!==SETUPS.get(e)&&(t=SETUPS.get(e)),t}_hasSubString(e,t){return-1!==e.indexOf(t)}_getSubStringByMarker(e,t){return this._hasSubString(e,t)?e.substr(e.indexOf(t)+t.length):""}_removeTrailingHtmlString(e){let t=e;return t.indexOf(".html")>0&&(t=t.substr(0,t.indexOf(".html"))),t}}const j=new class{constructor(){this.pageObjectCallbacks=[],this.getData=this.getData.bind(this),this._getRegisteredPageObjects=this._getRegisteredPageObjects.bind(this)}register(e,t){let a=0===this.pageObjectCallbacks.length?1:this.pageObjectCallbacks.length;t?this.pageObjectCallbacks[0]=e:this.pageObjectCallbacks[a]=e}unregister(e){let t=this.pageObjectCallbacks.indexOf(e);this.pageObjectCallbacks.splice(t,1)}async getData(){let e=await this._getRegisteredPageObjects();return this._mergeObjects(...e)}async _getRegisteredPageObjects(){let e=[];for(let t in this.pageObjectCallbacks)if(t&&this.pageObjectCallbacks[t]){let a=await this.pageObjectCallbacks[t]();e.push(a)}return e}_mergeObjects(){const e=e=>e&&"object"==typeof e;for(var t=arguments.length,a=new Array(t),s=0;s<t;s++)a[s]=arguments[s];return a.reduce(((t,a)=>(Object.keys(a).forEach((s=>{const n=t[s],i=a[s];Array.isArray(n)&&Array.isArray(i)?t[s]=i:e(n)&&e(i)?t[s]=this._mergeObjects(n,i):t[s]=i})),t)),{})}};class D{constructor(){if(D._instance)return D._instance;this.pagePageInfo=new k,this.pageCategory=new T,this.pageAttributes=new O,this.articleAttributes=new y,j.register(D.getData,!0),D._instance=this}static async getData(){let e=D._instance.pageCategory.getPageType(document),t={attributes:{applicationName:D._instance.pageAttributes.getApplicationName(),applicationVersion:D._instance.pageAttributes.getApplicationVersion(),implementer:D._instance.pageAttributes.getImplementer(),site:D._instance.pageAttributes.getSite()},category:{displayType:D._instance.pageCategory.getDisplayType(window.location.href),pageType:e},pageInfo:{breadCrumbs:D._instance.pagePageInfo.getBreadCrumbs(window.location.href,window.location.pathname),destinationURL:D._instance.pagePageInfo.getDestinationUrl(),language:D._instance.pagePageInfo.getLanguage(window.location.href,window.location.pathname),market:D._instance.pagePageInfo.getMarket(window.location.href,window.location.pathname),pageID:D._instance.pagePageInfo.getPageID(window.location.href,window.location.pathname),pageName:D._instance.pagePageInfo.getPageName(document),referringURL:D._instance.pagePageInfo.getReferringUrl(),sysEnv:D._instance.pagePageInfo.getSysEnv(window.location.host)}};return"articlePage"==e&&Object.assign(t.attributes,D._instance.articleAttributes.getArticleAttributes()),t}}new D;const w=new class{constructor(){this.productObjectCallbacks=[],this.getData=this.getData.bind(this),this._getRegisteredProductObjects=this._getRegisteredProductObjects.bind(this)}register(e,t){let a=0===this.productObjectCallbacks.length?1:this.productObjectCallbacks.length;t?this.productObjectCallbacks[0]=e:this.productObjectCallbacks[a]=e}unregister(e){let t=this.productObjectCallbacks.indexOf(e);this.productObjectCallbacks.splice(t,1)}async getData(){return(await this._getRegisteredProductObjects()).reduce(((e,t)=>e.concat(t)),[])}async _getRegisteredProductObjects(){let e=[];for(let t in this.productObjectCallbacks)if(t&&this.productObjectCallbacks[t]){let a=await this.productObjectCallbacks[t]();e.push(a)}return e}};class v{constructor(){if(v._instance)return v._instance;w.register(v.getData,!0),v._instance=this}static async getData(){return[]}}new v;const E=new class{constructor(){this.cartObjectCallbacks=[],this.getData=this.getData.bind(this),this._getRegisteredCartObjects=this._getRegisteredCartObjects.bind(this)}register(e,t){const a=0===this.cartObjectCallbacks.length?1:this.cartObjectCallbacks.length;t?this.cartObjectCallbacks[0]=e:this.cartObjectCallbacks[a]=e}unregister(e){const t=this.cartObjectCallbacks.indexOf(e);this.cartObjectCallbacks.splice(t,1)}async getData(){const e=await this._getRegisteredCartObjects();return a.mergeObjects(...e)}async _getRegisteredCartObjects(){let e=[];for(const t in this.cartObjectCallbacks)if(t&&this.cartObjectCallbacks[t]){const a=await this.cartObjectCallbacks[t]();e.push(a)}return e}};class C{constructor(){if(C._instance)return C._instance;E.register(this.getData,!0),C._instance=this}async getData(){return{}}}new C;class A{static get REGISTERED_DIGITALDATA_OBJECTS(){return["page","component","dealer","product","cart","user","search"]}constructor(){if(A._instance)return A._instance;window.digitalData=window.digitalData||{},window.digitalData.event=window.digitalData.event||[],this.eventObjectsQueue=[],this.registeredPropertyObjectsQueue={},A._instance=this}storeObjectsInDigitalData(e){window.digitalData.hasOwnProperty("page")?this._writeDataToWindowObject(e):e.hasOwnProperty("page")?this._writeDataToWindowObject(this._mergeRegisteredPropertyObjects(e)):Object.keys(e).forEach((t=>{this.registeredPropertyObjectsQueue[t]=e[t]}))}storeEventsInDigitalData(e){Object.keys(e).length>0&&(0===window.digitalData.event.length&&"page_load"!==this._getEventAction(e)?this.eventObjectsQueue.push(e):(window.digitalData.event.push(e),this._processEventObjectsQueue()))}_writeDataToWindowObject(e){A.REGISTERED_DIGITALDATA_OBJECTS.forEach((t=>{void 0!==e[t]&&(window.digitalData[t]=e[t])}))}_mergeRegisteredPropertyObjects(e){return e&&this.registeredPropertyObjectsQueue!=={}&&A.REGISTERED_DIGITALDATA_OBJECTS.forEach((t=>{void 0!==this.registeredPropertyObjectsQueue[t]&&(e[t]=this.registeredPropertyObjectsQueue[t])})),this.registeredPropertyObjectsQueue={},e}_processEventObjectsQueue(){const e=this.eventObjectsQueue.length;if(e>0){for(let t=0;t<e;t+=1)window.digitalData.event.push(this.eventObjectsQueue[t]);this.eventObjectsQueue=[]}}_getEventAction(e){let t="";return e&&e.eventInfo&&e.eventInfo.eventAction&&(t=e.eventInfo.eventAction),t}}const L=new A;class P{_trackingStoreName="audi:authStore";constructor(){if(P._instance)return P._instance;this.userObjectCallbacks=[],this.initialize(),P._instance=this}register(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("function"!=typeof e)throw new Error("bad parameter: callback_ is not of type function");const a=0===this.userObjectCallbacks.length?1:this.userObjectCallbacks.length;t?this.userObjectCallbacks[0]=e:this.userObjectCallbacks[a]=e}unregister(e){let t=this.userObjectCallbacks.indexOf(e);-1!==t&&this.userObjectCallbacks.splice(t,1)}async getData(){const e=await this._getRegisteredUserObjects();return a.mergeObjects(...e)}async _getRegisteredUserObjects(){let e=[];for(const t in this.userObjectCallbacks)if(t&&this.userObjectCallbacks[t]){const a=await this.userObjectCallbacks[t]();e.push(a)}return e}initialize(){this._saveTrackingData=this._saveTrackingData.bind(this),this._getEventData=this._getEventData.bind(this),this._isWithinLifeTime=this._isWithinLifeTime.bind(this),this._updateTrackingSessionStore=this._updateTrackingSessionStore.bind(this),this.getTrackingSessionStore=this.getTrackingSessionStore.bind(this),this._subscribeToAuthenticationStore=this._subscribeToAuthenticationStore.bind(this),this._analyzeAuthenticationEvent=this._analyzeAuthenticationEvent.bind(this),this._subscribeToPageLoaded=this._subscribeToPageLoaded.bind(this),this._handleRefreshSession=this._handleRefreshSession.bind(this),this._getTrackingSessionStoreRaw=this._getTrackingSessionStoreRaw.bind(this),this._subscribeToAuthenticationStore(),this._subscribeToPageLoaded()}_subscribeToPageLoaded(){document.addEventListener("PAGE_READY",this._handleRefreshSession),document.addEventListener("LAYER_LOADED",this._handleRefreshSession),document.addEventListener("LAYER_CLOSED",this._handleRefreshSession)}_handleRefreshSession(){const e=this._getTrackingSessionStoreRaw();if(e){const t=e.timestamp;if(this._updateTrackingSessionStore(e.isAuthenticated),!this._isWithinLifeTime(t)&&e.isAuthenticated){let t=this._getEventData(e.isAuthenticated);this._saveTrackingData(t)}}}_subscribeToAuthenticationStore(){window&&window.microkernel&&window.microkernel.stateRegistry&&window.microkernel.stateRegistry.subscribeToStore("dbadAuthServiceStore",(e=>{this._analyzeAuthenticationEvent(e)}))}_analyzeAuthenticationEvent(e){let t=this.getTrackingSessionStore(),a=!!e&&e.isAuthenticated;if(this._updateTrackingSessionStore(a),!t&&a||t&&a!=t.isAuthenticated){let e=this._getEventData(a);this._saveTrackingData(e)}}_isWithinLifeTime(e){if(e){return Date.now()-e<18e5}return!1}_updateTrackingSessionStore(e){let t=JSON.stringify({isAuthenticated:e,timestamp:(new Date).getTime()});window.localStorage.setItem(this._trackingStoreName,t)}_getTrackingSessionStoreRaw(){const e=window.localStorage&&window.localStorage.getItem(this._trackingStoreName);if(e&&""!==e){return JSON.parse(e)}return null}getTrackingSessionStore(){const e=this._getTrackingSessionStoreRaw();if(e){if(this._isWithinLifeTime(e.timestamp))return e}return null}_getEventData(e){return{attributes:{clickID:"",componentName:"",currentUrl:`${window.location.hostname}${window.location.pathname}`,elementName:"",label:"",pos:"",targetUrl:"",value:""},eventInfo:{eventAction:"non_interaction",eventName:e?"user logged in":"user logged out"}}}async _saveTrackingData(e){if(e){if(Object.prototype.hasOwnProperty.call(window.digitalData,"page")){const e=await this.getData();L.storeObjectsInDigitalData({user:[e]})}L.storeEventsInDigitalData(e)}}}const I=new P;class U{constructor(){if(U._instance)return U._instance;I.register(U.getData,!0),U._instance=this}static async getData(){const e=I.getTrackingSessionStore();let t=!1;e&&(t=e.isAuthenticated);return{segment:{isLoggedIn:t}}}}new U;const R=new class{constructor(){this.searchObjectCallbacks=[],this.getData=this.getData.bind(this),this._getRegisteredSearchObjects=this._getRegisteredSearchObjects.bind(this)}register(e,t){const a=0===this.searchObjectCallbacks.length?1:this.searchObjectCallbacks.length;t?this.searchObjectCallbacks[0]=e:this.searchObjectCallbacks[a]=e}unregister(e){const t=this.searchObjectCallbacks.indexOf(e);this.searchObjectCallbacks.splice(t,1)}async getData(){const e=await this._getRegisteredSearchObjects();return a.mergeObjects(...e)}async _getRegisteredSearchObjects(){let e=[];for(const t in this.searchObjectCallbacks)if(t&&this.searchObjectCallbacks[t]){const a=await this.searchObjectCallbacks[t]();e.push(a)}return e}};class x{constructor(){if(x._instance)return x._instance;R.register(this.getData,!0),x._instance=this}async getData(){return{}}}new x;class N{static get CUSTOM_TRACKING_EVENT(){return"CUSTOM_TRACKING_EVENT"}}class M{constructor(){if(M._instance)return M._instance;this.getData=this.getData.bind(this),this.layerCloseSelectors=[],l.register(this.getData),M._instance=this}registerLayerCloseSelector(e){this.layerCloseSelectors.push(e)}async getData(e){const t=o.getTarget(e);return this._isLayerCloseLink(t)?{eventInfo:{eventAction:"layer_close_click"}}:{}}_isLayerCloseLink(e){for(const t of this.layerCloseSelectors)if(e&&e.closest(t)===e)return!0;return!1}}const F=new M;class q{constructor(){if(q._instance)return q._instance;this.getData=this.getData.bind(this),this.layerOpenSelectors=[],l.register(this.getData),q._instance=this}registerLayerOpenSelector(e){this.layerOpenSelectors.push(e)}async getData(e){const t=o.getTarget(e);return this._isLayerOpenLink(t)?{eventInfo:{eventAction:"layer_open_click"}}:{}}_isLayerOpenLink(e){for(const t of this.layerOpenSelectors)if(e&&e.closest(t)===e)return!0;return!1}}const B=new q;class V{constructor(){if(V._instance)return V._instance;this.getData=this.getData.bind(this),this.tabSelectors=[],l.register(this.getData),V._instance=this}registerTabSelector(e){this.tabSelectors.push(e)}async getData(e){const t=o.getTarget(e);return this._isTab(t)?{attributes:{elementName:"tab"}}:{}}_isTab(e){for(const t of this.tabSelectors)if(e&&e.closest(t)===e)return!0;return!1}}const Q=new V;return t})()));
//# sourceMappingURL=audi-core-tracking-objects.js.map